<script setup lang="ts">
import { ref, onMounted, computed, watch } from 'vue';
import { useRoute } from 'vue-router'
import { router } from '@/router';

import BaseBreadcrumb from '@/components/shared/BaseBreadcrumb.vue';
import UiParentCard from '@/components/shared/UiParentCard.vue';
import { useOrganizationStore } from '@/stores/organizationStore';
import { useMainAuditStore } from '@/stores/mainAuditStore';
import { useAuthStore } from '@/stores/auth';
import { useOpenLinksStore } from '@/stores/openLinks';
import moment from 'moment'
import Swal from 'sweetalert2'


const page = ref({ title: 'Ongoing HSE Audit' });
const breadcrumbs = ref([
    {
        text: 'Dashboard',
        disabled: false,
        href: 'dashboard'
    },
    {
        text: 'HSE Audit',
        disabled: false,
        href: 'hse-audit'
    },
    {
        text: 'Ongoing',
        disabled: true,
        href: '#'
    }
]);

const route = useRoute()
const authStore = useAuthStore();
const organizationStore = useOrganizationStore();
const openLinks = useOpenLinksStore();
const mainAuditStore = useMainAuditStore();


onMounted(() => {
    mainAuditStore.getOngoingMainAudit(route.params.main_audit_id)

    openLinks.getPriorities();
});


const getPriorities = computed(() => (openLinks.priorities));

const getAuthUser = computed(() => (authStore.loggedUser));
const getOngoingMainAudit = computed(() => (mainAuditStore.mainAudit));
const getActiveOrg = computed(() => (organizationStore.getActiveOrg()));
const isAuditingOrg = computed(() => (getOngoingMainAudit.value?.organization_id == getActiveOrg.value?.id));
const isLoggedInUserOwnsActionOrg = computed(() => (getAuthUser.value?.id == getActiveOrg.value?.user_id));
const isAuditeeOrg = computed(() => (getOngoingMainAudit.value?.recipient_organization_id == getActiveOrg.value?.id));

const getAuditMembers = computed(() => (mainAuditStore.auditMembers));
const getAuditeeMembers = computed(() => (mainAuditStore.auditeeMembers));

watch(
  () => isAuditingOrg.value,
  (value) => {
    if(value) {  
        mainAuditStore.getAuditMembers(route.params.main_audit_id)
    }
  }
)
watch(
  () => isAuditeeOrg.value,
  (value) => {
      if (value) {
        mainAuditStore.getAuditeeMembers(route.params.main_audit_id)
    }
  }
)

//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------




const valid = ref(true);;
const formContainer = ref()
const loading = ref(false);
const setLoading = (value: boolean) => {
    loading.value = value;
}


const addAuditorsDialog = ref(false);
const setAddAuditorsDialog = (value: boolean) => {
    addAuditorsDialog.value = value;
}
const addRepresentativeDialog = ref(false);
const setAddRepresentativeDialog = (value: boolean) => {
    addRepresentativeDialog.value = value;
}


const viewReportDialog = ref(false);
const setViewReportDialog = (value: boolean) => {
    viewReportDialog.value = value;
}
const addInviteDialog = ref(false);
const setAddInviteDialog = (value: boolean) => {
    addInviteDialog.value = value;
}
const addMemberDialog = ref(false);
const setAddMemberDialog = (value: boolean) => {
    addMemberDialog.value = value;
}
const viewQuestionTeamDialog = ref(false);
const setSelectQuestionaireTeam = (value: boolean) => {
    viewQuestionTeamDialog.value = value;
}

const viewQuestionDialog = ref(false);
const setViewQuestionDialog = (value: boolean) => {
    viewQuestionDialog.value = value;
    if (value == false) selectItem({})
}
const viewFindingDialog = ref(false);
const setViewFindingDialog = (value: boolean, type: string = '') => {
    viewFindingDialog.value = value;
    stepFourFields.value.type = type;
    if (value == false) selectItem({})
}
const viewRecommendationDialog = ref(false);
const setViewRecommendationDialog = (value: boolean, type: string = '') => {
    viewRecommendationDialog.value = value;
    if (value == false) selectItem({})
}
const selectedItem = ref({});
const selectItem = (item: any, action: string = '', extra: any = '') => {
    selectedItem.value = Object.assign({}, item.raw);

    switch (action) {
        case 'viewQuestion':
            setViewQuestionDialog(true)
            break;
        case 'viewFinding':
            setViewFindingDialog(true, extra)
            break;
        case 'viewRecommendation':
            setViewFindingDialog(true)
            break;
        // case 'edit':

        //     setEditDialog(true)
        //     break;
        // case 'delete':
        //     setDeleteDialog(true)
        //     break;
        default:
            break;
    }

}

//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
const fields = ref({

    leadAuditor: '',
    supportAuditor: '',

    leadRepresentative: '',
    representatives: [],

    organization_id: getActiveOrg.value?.uuid,
});



const filteredLeadAuditMembers = computed(() => (getAuditMembers.value?.filter((member: any) => (member.id != fields.value?.leadAuditor))));
const filteredSupportAuditMembers = computed(() => (getAuditMembers.value?.filter((member: any) => (member.id != fields.value?.supportAuditor && member.id != getOngoingMainAudit.value?.lead_representative?.user_id))));
const getRepresentatives = computed(() => (getOngoingMainAudit.value?.all_representatives));
const getAuditors = computed(() => (getOngoingMainAudit.value?.all_auditors));
const filteredGetAuditeeMembers = computed(() => (getAuditeeMembers.value?.filter((member: any) => (member.id != fields.value?.leadRepresentative  && member.id != getOngoingMainAudit.value?.lead_auditor?.user_id))));

const isLoggedInUserIsLeadAuditor= computed(() => (getAuthUser.value?.id == getOngoingMainAudit.value?.lead_auditor?.member?.id));
const isLoggedInUserIsLeadRepresentative= computed(() => (getAuthUser.value?.id == getOngoingMainAudit.value?.lead_representative?.member?.id));

const fieldRules: any = ref({
    leadAuditor: [
        (v: number) => !!v || 'Field is Required',
    ],
    supportAuditor: [
        (v: number) => !!v || 'Field is Required',
    ],
    leadRepresentative: [
        (v: number) => !!v || 'Field is Required',
    ],
    representatives: [
        (v: number) => !!v || 'Field is Required',
    ],
    leadInvestigator: [
        (v: number) => !!v || 'Field is Required',
    ],
    teamMember: [
        (v: number) => !!v || 'Field is Required',
    ],
    groupChatName: [
        (v: string) => !!v || 'Field is Required',
    ],
})


const sendAuditors = async (e: any) => {
    e.preventDefault();

    try {
        setLoading(true)

        const values = { ...fields.value }
        
        
        
        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "main_audit_id": getOngoingMainAudit.value?.uuid,
            "lead_auditor": values?.leadAuditor,
            "support_auditor":  values?.supportAuditor,
        }

        const resp = await mainAuditStore.setAuditors(objectValues)
            .catch((error: any) => {
                console.log(error)
                throw error
            })
            .then((resp: any) => {
                return resp
            });

        if (resp?.message == 'success') {
            setLoading(false)
            setAddAuditorsDialog(false)
            mainAuditStore.getOngoingMainAudit(route.params.main_audit_id);
        }

        setLoading(false)
        setAddAuditorsDialog(false)



    } catch (error) {
        console.log(error)
        setLoading(false)
        setAddAuditorsDialog(false)
    }

}

const sendRepresentatives = async (e: any) => {
    e.preventDefault();

    try {
        setLoading(true)

        const values = { ...fields.value }
        
        
        
        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "main_audit_id": getOngoingMainAudit.value?.uuid,
            "lead_representative": values?.leadRepresentative,
            "team_representatives":  values?.representatives,
        }

        const resp = await mainAuditStore.setAuditee(objectValues)
            .catch((error: any) => {
                console.log(error)
                throw error
            })
            .then((resp: any) => {
                return resp
            });

        if (resp?.message == 'success') {
            setLoading(false)
            setAddRepresentativeDialog(false)
            mainAuditStore.getOngoingMainAudit(route.params.main_audit_id);
        }

        setLoading(false)
        setAddRepresentativeDialog(false)



    } catch (error) {
        console.log(error)
        setLoading(false)
        setAddRepresentativeDialog(false)
    }

}

const removeMember = async (member: any) => {

    try {
        setLoading(true)
        
        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "main_audit_id": getOngoingMainAudit.value?.uuid,
            "team_member":  member
        }
        
        Swal.fire({
            title: 'Info!',
            text: 'Do you want to remove member?',
            icon: 'info',
            confirmButtonText: 'Yes',
            cancelButtonText: 'No',
            showCancelButton: true,
            allowOutsideClick: false,
        }).then((result) => {
            if (result.isConfirmed) {
                
                
                mainAuditStore.removeMember(objectValues)
                    .catch((error: any) => {
                        throw error
                    })
                    .then((resp: any) => {
                         mainAuditStore.getOngoingMainAudit(route.params.main_audit_id);
                        return resp
                    });


            }
        });


        setLoading(false)

    } catch (error) {
        console.log(error)
        setLoading(false)
    }

}
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------


const requestDocumentDialog = ref(false);
const setRequestDocumentDialog = (value: boolean) => {
    requestDocumentDialog.value = value;
}

const sendDocumentDialog = ref(false);
const setSendDocumentDialog = (value: boolean, item_id : any = '') => {
    sendDocumentDialog.value = value;
    stepTwoFields.value.document_id = item_id
}

const showRejectDialog = ref(false);
const setRejectReasonDialog = (value: boolean, item_id : any = '') => {
    showRejectDialog.value = value;
    stepTwoFields.value.document_id = item_id
}

const getDocuments = computed(() => (getOngoingMainAudit.value?.documents));

const stepTwoFields = ref({
    title: "",
    document_id: "",
    description: "",
    comments: "",
    reason: "",
    files: '',

});

const stepTwoFieldRules: any = ref({
    title: [
        (v: string) => !!v || 'Field is Required',
    ],
    description: [
        (v: string) => !!v || 'Field is Required',
    ],
    comments: [
        (v: string) => !!v || 'Field is Required',
    ],
    reason: [
        (v: string) => !!v || 'Field is Required',
    ],
    files: [
        (v: string) => !!v || 'Field is Required',
    ],
})

const requestDocument = async (e: any) => {
    e.preventDefault();

    try {
        setLoading(true)

        const values = { ...stepTwoFields.value }
        
        
        
        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "main_audit_id": getOngoingMainAudit.value?.uuid,
            "title": values?.title,
            "description":  values?.description,
        }

        const resp = await mainAuditStore.requestDocument(objectValues)
            .catch((error: any) => {
                console.log(error)
                throw error
            })
            .then((resp: any) => {
                return resp
            });


        if (resp?.message == 'success') {
            setLoading(false)
            setRequestDocumentDialog(false)
            mainAuditStore.getOngoingMainAudit(route.params.main_audit_id);
        }

        setLoading(false)
        setRequestDocumentDialog(false)

    stepTwoFields.value.title = ""
    stepTwoFields.value.description = ""

    } catch (error) {
        console.log(error)
        setLoading(false)
        setRequestDocumentDialog(false)
    }

}

const sendDocument = async (e: any) => {
    e.preventDefault();

    try {
        setLoading(true)

        const values = { ...stepTwoFields.value }

        let formData = new FormData()
        formData.append('organization_id', getActiveOrg.value?.uuid)
        formData.append('main_audit_id', getOngoingMainAudit.value?.uuid)
        formData.append('main_audit_document_id', values?.document_id)
        formData.append('recipient_comment', values?.comments)
        formData.append('file', values?.files[0])

        const resp = await mainAuditStore.sendDocument(formData)
            .catch((error: any) => {
                console.log(error)
                throw error
            })
            .then((resp: any) => {
                return resp
            });

        if (resp?.message == 'success') {
            setLoading(false)
            setSendDocumentDialog(false)
            mainAuditStore.getOngoingMainAudit(route.params.main_audit_id);
        }

        setLoading(false)
        setSendDocumentDialog(false)

        stepTwoFields.value.comments = ""
        stepTwoFields.value.files = ""


    } catch (error) {
        console.log(error)
        setLoading(false)
        setSendDocumentDialog(false)
    }

}


const removeDocument = async (document: any) => {

    try {
        setLoading(true)
        
        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "main_audit_id": getOngoingMainAudit.value?.uuid,
            "main_audit_document_id":  document
        }
        
        Swal.fire({
            title: 'Info!',
            text: 'Do you want to remove document?',
            icon: 'info',
            confirmButtonText: 'Yes',
            cancelButtonText: 'No',
            showCancelButton: true,
            allowOutsideClick: false,
        }).then((result) => {
            if (result.isConfirmed) {
                
                
                mainAuditStore.actionRemoveDocument(objectValues)
                    .catch((error: any) => {
                        throw error
                    })
                    .then((resp: any) => {
                         mainAuditStore.getOngoingMainAudit(route.params.main_audit_id);
                        return resp
                    });


            }
        });


        setLoading(false)

    } catch (error) {
        console.log(error)
        setLoading(false)
    }

}
const revertDocument = async (document: any) => {

    try {
        setLoading(true)
        
        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "main_audit_id": getOngoingMainAudit.value?.uuid,
            "main_audit_document_id":  document
        }
        
        Swal.fire({
            title: 'Info!',
            text: 'Do you want to revert document?',
            icon: 'info',
            confirmButtonText: 'Yes',
            cancelButtonText: 'No',
            showCancelButton: true,
            allowOutsideClick: false,
        }).then((result) => {
            if (result.isConfirmed) {
                
                
                mainAuditStore.actionRevertDocument(objectValues)
                    .catch((error: any) => {
                        throw error
                    })
                    .then((resp: any) => {
                         mainAuditStore.getOngoingMainAudit(route.params.main_audit_id);
                        return resp
                    });


            }
        });


        setLoading(false)

    } catch (error) {
        console.log(error)
        setLoading(false)
    }

}
const actionDocument = async (document: any, action: string) => {

    try {
        
        let item_id = document ? document : stepTwoFields.value.document_id
                setRejectReasonDialog(false,stepTwoFields.value.document_id)
        setLoading(true)
        
        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "main_audit_id": getOngoingMainAudit.value?.uuid,
            "main_audit_document_id":  item_id,
            "action":  action,
            "reason":  stepTwoFields.value.reason,
        }

        
        Swal.fire({
            title: 'Info!',
            text: 'Are you sure?',
            icon: 'info',
            confirmButtonText: 'Yes',
            cancelButtonText: 'No',
            showCancelButton: true,
            allowOutsideClick: false,
        }).then((result) => {
            if (result.isConfirmed) {

                
                mainAuditStore.actionAuditDocument(objectValues)
                    .catch((error: any) => {
                        throw error
                    })
                    .then((resp: any) => {
                         mainAuditStore.getOngoingMainAudit(route.params.main_audit_id);
                        return resp
                    });


            }
        });


        setLoading(false)

    } catch (error) {
        console.log(error)
        setLoading(false)
    }

}
const files = ref([])
const images = ref([])
const previewImage = ref([])

const selectImage = (image: any) => {
    stepTwoFields.value.files =  image.target.files
    images.value = image.target.files;
    previewImage.value = [];

    for (let index = 0; index < images.value.length; index++) {
        const element = images.value[index];
        previewImage.value.push(URL.createObjectURL(element))
    }

}


//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------

const sendScheduleDialog = ref(false);
const setSendScheduleDialog = (value: boolean) => {
    sendScheduleDialog.value = value;
}
const confirmScheduleDialog = ref(false);
const setConfirmScheduleDialog = (value: boolean) => {
    confirmScheduleDialog.value = value;
}
const getSchedule = computed(() => (getOngoingMainAudit.value?.schedule));

const stepThreeFields = ref({
    date_time: "",
});

const stepThreeFieldRules: any = ref({
    date_times: [
        (v: string) => !!v || 'Field is Required',
    ],
})

const actionAuditorTime = async (e: any) => {
    e.preventDefault();

    try {
        setLoading(true)

        const values = { ...stepThreeFields.value }

        const date_times = moment(values?.date_time).format('YYYY-MM-DD hh:mm:ss')

        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "main_audit_id": getOngoingMainAudit.value?.uuid,
            "start_date": date_times,
        }

        const resp = await mainAuditStore.actionAuditorTime(objectValues)
            .catch((error: any) => {
                console.log(error)
                throw error
            })
            .then((resp: any) => {
                return resp
            });

        if (resp?.message == 'success') {
            setLoading(false)
            setSendScheduleDialog(false)
            mainAuditStore.getOngoingMainAudit(route.params.main_audit_id);
        }

        setLoading(false)
        setSendScheduleDialog(false)

        stepThreeFields.value.date_time = "";

    } catch (error) {
        console.log(error)
        setLoading(false)
        setSendScheduleDialog(false)
    }

}
const actionAuditeeTime = async (e: any) => {
    e.preventDefault();

    try {
        setLoading(true)

        const values = { ...stepThreeFields.value }

        const date_times = moment(values?.date_time).format('YYYY-MM-DD hh:mm:ss')

        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "main_audit_id": getOngoingMainAudit.value?.uuid,
            "start_date": date_times,
        }

        const resp = await mainAuditStore.actionAuditeeTime(objectValues)
            .catch((error: any) => {
                console.log(error)
                throw error
            })
            .then((resp: any) => {
                return resp
            });

        if (resp?.message == 'success') {
            setLoading(false)
            setConfirmScheduleDialog(false)
            mainAuditStore.getOngoingMainAudit(route.params.main_audit_id);
        }

        setLoading(false)
        setConfirmScheduleDialog(false)
        stepThreeFields.value.date_time = "";



    } catch (error) {
        console.log(error)
        setLoading(false)
        setConfirmScheduleDialog(false)
    }

}
const actionAcceptedTime = async (value: any) => {


    try {


        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "main_audit_id": getOngoingMainAudit.value?.uuid,
            "action": value,
        }

        
        Swal.fire({
            title: 'Info!',
            text: 'Are you sure?',
            icon: 'info',
            confirmButtonText: 'Yes',
            cancelButtonText: 'No',
            showCancelButton: true,
            allowOutsideClick: false,
        }).then((result) => {
            if (result.isConfirmed) {

                
                mainAuditStore.actionAcceptedTime(objectValues)
                    .catch((error: any) => {
                        throw error
                    })
                    .then((resp: any) => {
                         mainAuditStore.getOngoingMainAudit(route.params.main_audit_id);
                        return resp
                    });


            }
        });
        



    } catch (error) {
        console.log(error)
    }

}


//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------


const questionTab = ref('question-tab-0');
const questionOldTab = ref('');

function changeQuestionTab(e: string) {
    questionTab.value = e;
}
// console.log(questionTab.value)
const getQuestions = computed(() => (getOngoingMainAudit.value?.questions));

const sendCommentDialog = ref(false);
const setSendCommentDialog = (value: boolean, item_id: string = '', topic_id: string = '', question = {}) => {
    sendCommentDialog.value = value;
    stepFourFields.value.question_id = item_id
    stepFourFields.value.topic_id = topic_id
    stepFourFields.value.comments = question?.comment ? question?.comment  : (question?.response?.comment ? question?.response?.comment : "")
}

const stepFourFields = ref({
    question_id: "",
    topic_id: "",
    comments: "",
});


const stepFourFieldRules: any = ref({
    response: [
        (v: string) => !!v || 'Field is Required',
    ],
    comments: [
        (v: string) => !!v || 'Field is Required',
    ],
})


const auditSendResponse = async (question_id: number, response: string, topic : number) => {
    

    try {

        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "main_audit_id": getOngoingMainAudit.value?.uuid,
            "main_audit_question_id": question_id,
            "response": response,
        }

        const resp = await mainAuditStore.auditSendResponse(objectValues)
            .catch((error: any) => {
                console.log(error)
                throw error
            })
            .then((resp: any) => {
                return resp
            });

        if (resp?.message == 'success') {
            mainAuditStore.mainAudit.questions.forEach((question: any, index: number) => {
                if(question.id == topic) {
                     question.questions.forEach((main_question: any, subIndex: number) => {
                        if(main_question.id == question_id) {
                            mainAuditStore.mainAudit.questions[index].questions[subIndex].answer = response
                        }
                     })
                }
            })
            
        }


    } catch (error) {
        
    }

}


const auditSendComment = async (e: any) => {
    e.preventDefault();

    try {
        setLoading(true)

        const values = { ...stepFourFields.value }


        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "main_audit_id": getOngoingMainAudit.value?.uuid,
            "main_audit_question_id": values?.question_id,
            "comment": values?.comments,
        }

        const resp = await mainAuditStore.auditSendComment(objectValues)
            .catch((error: any) => {
                console.log(error)
                throw error
            })
            .then((resp: any) => {
                return resp
            });

        
        if (resp?.message == 'success') {
            mainAuditStore.mainAudit.questions.forEach((question: any, index: number) => {
                if(question.id == values?.topic_id) {
                     question.questions.forEach((main_question: any, subIndex: number) => {
                        if(main_question.id == values?.question_id) {
                            mainAuditStore.mainAudit.questions[index].questions[subIndex].comment = values?.comments
                        }
                     })
                }
            })
            
        }

        setLoading(false)
        setSendCommentDialog(false)

        stepFourFields.value.comments = "";

    } catch (error) {
        console.log(error)
        setLoading(false)
        setSendCommentDialog(false)
    }

}


//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------


const getFindings = computed(() => (getOngoingMainAudit.value?.findings));
const getActions = computed(() => (getOngoingMainAudit.value?.actions));


const stepFiveFields = ref({
    title: "",
    description: "",
    assigneeId: "",
    priorityId: "",
    end_date: "",
    start_date: "",
    detail: "",
    organization_id: getActiveOrg.value?.uuid,
    
});

const stepFiveFieldRules : any = ref({
    priorityId: [
        (v: string) => !!v || 'Priority is required',
    ],
    assigneeId: [
        (v: string) => !!v || 'User is required',
    ],
    title: [
        (v: string) => !!v || 'Title  is required',
    ],
    detail: [
        (v: string) => !!v || 'Title  is required',
    ],
    description: [
        (v: string) => !!v || 'Description is required',
        (v: string) => v.length > 10 || 'More than ten letters required'
    ],
    end_date: [
        (v: string) => !!v || 'End Date is required',
        // (v: string) => v.length > 10 || 'More than ten letters required'
    ],
    start_date: [
        (v: string) => !!v || 'Start Date is required',
        // (v: string) => v.length > 10 || 'More than ten letters required'
    ],
})

const sendFindings = async (e: any) => {
    e.preventDefault();

    try {
        setLoading(true)

        const values = { ...stepFiveFields.value }


        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "main_audit_id": getOngoingMainAudit.value?.uuid,
            "detail":  values?.detail,
        }

        const resp = await mainAuditStore.sendAuditFindings(objectValues)
            .catch((error: any) => {
                console.log(error)
                throw error
            })
            .then((resp: any) => {
                return resp
            });

        if (resp?.message == 'success') {
            setLoading(false)
            setViewFindingDialog(false)
            mainAuditStore.getOngoingMainAudit(route.params.main_audit_id);
        }

        setLoading(false)
        setViewFindingDialog(false)
        stepFiveFields.value.detail = ''
    } catch (error) {
        console.log(error)
        setLoading(false)           
         setViewFindingDialog(false)
    }


}
const sendRecommendation = async (e: any) => {
    e.preventDefault();

    try {
        setLoading(true)

        const values = { ...stepFiveFields.value }

        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "main_audit_id": getOngoingMainAudit.value?.uuid,
            "title": values?.title,
            "description": values?.description,
            "assignee_id": values?.assigneeId,
            "start_date": moment(values?.start_date).format('YYYY-MM-DD HH:mm:ss'),
            "end_date":  moment(values?.end_date).format('YYYY-MM-DD HH:mm:ss'),  
            "priority_id": values?.priorityId
        }


        const resp = await mainAuditStore.sendAuditRecommendations(objectValues)
            .catch((error: any) => {
                console.log(error)
                throw error
            })
            .then((resp: any) => {
                return resp
            });


        if (resp?.message == 'success') {
            setLoading(false)
            setViewRecommendationDialog(false)
            mainAuditStore.getOngoingMainAudit(route.params.main_audit_id);
        }

        setLoading(false)
        setViewRecommendationDialog(false)



    } catch (error) {
        console.log(error)
        setLoading(false)
        setViewRecommendationDialog(false)
    }

}


const completeInvestigation = async (member: any) => {

    try {
        setLoading(true)
        
        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "main_audit_id": getOngoingMainAudit.value?.uuid,
        }
        
        Swal.fire({
            title: 'Info!',
            text: 'Do you want to close audit?',
            icon: 'info',
            confirmButtonText: 'Yes',
            cancelButtonText: 'No',
            showCancelButton: true,
            allowOutsideClick: false,
        }).then((result) => {
            if (result.isConfirmed) {
                
                
                mainAuditStore.completeAudit(objectValues)
                    .catch((error: any) => {
                        throw error
                    })
                    .then((resp: any) => {
                        //  investigationStore.getInvestigation(route.params.observation_id);
                        // router.push(`/hse-investigation`)
                        return resp
                    });


            }
        });

        
            


        setLoading(false)

    } catch (error) {
        console.log(error)
        setLoading(false)
    }

}


//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------

// ---------------------------------------------------

const thankyou = ref(false);

const tab = ref('tab-1');
const checkbox = ref([]);

function changeTab(e: string) {
    tab.value = e;
}
const blankFn = () => {
    console.log('black')
}



</script>

<template>
    <div>
        <BaseBreadcrumb :title="page.title" :breadcrumbs="breadcrumbs"></BaseBreadcrumb>


        <v-row v-if="getOngoingMainAudit">
            <v-col cols="12" md="11">

                <UiParentCard variant="outlined">
                    <v-card-text>
                        <h1 class="text-uppercase mb-3"> Audit Title - {{ getOngoingMainAudit?.audit_title }}</h1>
                        <h2 class="text-uppercase mb-3">Organization - {{ getOngoingMainAudit?.recipient_organization?.name }}</h2>
                    </v-card-text>
                    <v-card-text>
                        <v-tabs v-model="tab" color="primary" class="customTab">
                            <v-tab value="tab-1" rounded="md" class="mb-3 mx-2 text-left" height="70">
                                <UsersIcon stroke-width="1.5" width="20" class="v-icon--start" />
                                <div>
                                    <div>Build Team</div>
                                    <span
                                        class="text-subtitle-2 text-lightText text-medium-emphasis font-weight-medium d-block">Members</span>
                                </div>
                            </v-tab>

                            <v-tab value="tab-2" rounded="md" class="mb-3 mx-2 text-left" height="70"
                                :disabled="!isLoggedInUserIsLeadAuditor || !isLoggedInUserIsLeadRepresentative">
                                <FileDescriptionIcon stroke-width="1.5" width="20" class="v-icon--start" />
                                <div>
                                    <div>Audit Documents</div>
                                    <span
                                        class="text-subtitle-2 text-lightText text-medium-emphasis font-weight-medium d-block">
                                        Request
                                    </span>
                                </div>
                            </v-tab>

                            <v-tab value="tab-3" rounded="md" class="mb-3 mx-2 text-left" height="70"
                                :disabled="!isLoggedInUserIsLeadAuditor || !isLoggedInUserIsLeadRepresentative">
                                <CreditCardIcon stroke-width="1.5" width="20" class="v-icon--start" />
                                <div>
                                    <div>Send Schedule</div>
                                    <span
                                        class="text-subtitle-2 text-lightText text-medium-emphasis font-weight-medium d-block">
                                        To Organization
                                    </span>
                                </div>
                            </v-tab>
                            <v-tab value="tab-4" rounded="md" class="mb-3 mx-2 text-left" height="70"
                                :disabled="!isLoggedInUserIsLeadAuditor || !isLoggedInUserIsLeadRepresentative">
                                <CreditCardIcon stroke-width="1.5" width="20" class="v-icon--start" />
                                <div>
                                    <div>Onsite Audit</div>
                                    <span
                                        class="text-subtitle-2 text-lightText text-medium-emphasis font-weight-medium d-block">
                                        Start
                                    </span>
                                </div>
                            </v-tab>
                            <v-tab value="tab-5" rounded="md" class="mb-3 mx-2 text-left" height="70"
                                :disabled="!isLoggedInUserIsLeadAuditor || !isLoggedInUserIsLeadRepresentative">
                                <CreditCardIcon stroke-width="1.5" width="20" class="v-icon--start" />
                                <div>
                                    <div>Audit Findings </div>
                                    <span
                                        class="text-subtitle-2 text-lightText text-medium-emphasis font-weight-medium d-block">
                                        And Action
                                    </span>
                                </div>
                            </v-tab>
                        </v-tabs>
                        <v-window v-model="tab" class="customTab">
                            <v-window-item value="tab-1" class="pa-1">

                                <div>
                                    <v-row class="mt-3 px-4">

                                        <v-col cols="12">

                                            <v-btn color="primary" @click="setAddAuditorsDialog(true)" class="mr-2"
                                                v-if="isAuditingOrg">Add Auditors</v-btn>
                                            <v-btn color="primary" @click="setAddRepresentativeDialog(true)"
                                                class="mr-2" v-if="isAuditeeOrg">Add Representatives</v-btn>
                                            <v-sheet>
                                                <v-dialog v-model="addAuditorsDialog" max-width="800">
                                                    <v-card>


                                                        <v-card-text>
                                                            
                                                            <div class="d-flex justify-space-between">
                                                                <h3 class="text-h3">Add Auditor </h3>
                                                                <v-btn icon @click="setAddAuditorsDialog(false)"
                                                                    size="small" flat>
                                                                    <XIcon size="16" />
                                                                </v-btn>
                                                            </div>

                                                        </v-card-text>
                                                        <v-divider></v-divider>

                                                        <v-card-text>

                                                            <VForm v-model="valid" ref="formContainer" fast-fail
                                                                lazy-validation @submit.prevent="sendAuditors" class="py-1">
                                                                <VRow class="mt-5 mb-3">

                                                                    <VCol cols="12" md="12">
                                                                        <v-label class="font-weight-medium pb-1">Select
                                                                            Lead Auditor</v-label>
                                                                        <VSelect v-model="fields.leadAuditor"
                                                                            :items="filteredSupportAuditMembers"
                                                                            @update:modelValue="fields.supportAuditor = ''"
                                                                            :rules="fieldRules.leadAuditor"
                                                                            label="Select" item-title="lastName"
                                                                            item-value="id"
                                                                            :item-props="(item) => ({title:`${item?.lastName} ${item?.firstName}`, subtitle:`${item?.email}`})"
                                                                            single-line variant="outlined"
                                                                            class="text-capitalize">
                                                                        </VSelect>
                                                                    </VCol>
                                                                    
                                                                    <VCol cols="12" md="12">
                                                                        <v-label class="font-weight-medium pb-1">Select
                                                                            Support Auditor</v-label>
                                                                        <VSelect v-model="fields.supportAuditor"
                                                                            :items="filteredLeadAuditMembers"
                                                                            :rules="fieldRules.supportAuditor"
                                                                            label="Select" item-title="lastName"
                                                                            item-value="id"
                                                                            :item-props="(item) => ({title:`${item?.lastName} ${item?.firstName}`, subtitle:`${item?.email}`})"
                                                                            single-line variant="outlined"
                                                                            class="text-capitalize">
                                                                        </VSelect>
                                                                    </VCol>



                                                                    <VCol cols="12" lg="12" class="text-right">
                                                                        <v-btn color="error"
                                                                            @click="setAddAuditorsDialog(false)"
                                                                            variant="text">Cancel</v-btn>

                                                                        <v-btn color="primary" type="submit"
                                                                            :loading="loading" :disabled="!valid"
                                                                            @click="sendAuditors">
                                                                            <span v-if="!loading">
                                                                                Save
                                                                            </span>
                                                                            <clip-loader v-else :loading="loading"
                                                                                color="white"
                                                                                :size="'25px'"></clip-loader>
                                                                        </v-btn>

                                                                    </VCol>
                                                                </VRow>
                                                            </VForm>
                                                        </v-card-text>
                                                    </v-card>
                                                </v-dialog>

                                                <v-dialog v-model="addRepresentativeDialog" max-width="800">
                                                    <v-card>

                                                        <v-card-text>
                                                            <div class="d-flex justify-space-between">
                                                                <h3 class="text-h3">Add Representative </h3>
                                                                <v-btn icon @click="setAddRepresentativeDialog(false)"
                                                                    size="small" flat>
                                                                    <XIcon size="16" />
                                                                </v-btn>
                                                            </div>
                                                        </v-card-text>
                                                        <v-divider></v-divider>

                                                        <v-card-text>

                                                            <VForm v-model="valid" ref="formContainer" fast-fail
                                                                lazy-validation @submit.prevent="sendRepresentatives" class="py-1">
                                                                <VRow class="mt-5 mb-3">

                                                                    <VCol cols="12" md="12">
                                                                        <v-label class="font-weight-medium pb-1">Select
                                                                            a lead
                                                                            Representative</v-label>
                                                                        <VSelect v-model="fields.leadRepresentative"
                                                                            :items="getAuditeeMembers"
                                                                            update:modelValue="fields.representatives = []"
                                                                            :rules="fieldRules.leadRepresentative"
                                                                            label="Select" item-title="lastName"
                                                                            item-value="id"
                                                                            :item-props="(item) => ({title:`${item?.lastName} ${item?.firstName}`, subtitle:`${item?.email}`})"
                                                                            single-line variant="outlined"
                                                                            class="text-capitalize">
                                                                        </VSelect>
                                                                    </VCol>

                                                                    <VCol cols="12" md="12"
                                                                        v-if="fields.leadRepresentative">
                                                                        <v-label class="font-weight-medium pb-1">Select Representatives</v-label>
                                                                        <VSelect v-model="fields.representatives"
                                                                            :items="filteredGetAuditeeMembers"
                                                                            :rules="fieldRules.representatives"
                                                                            label="Select" item-title="lastName"
                                                                            item-value="id" single-line
                                                                            variant="outlined" class="text-capitalize"
                                                                            chips
                                                                            :item-props="(item) => ({title:`${item?.lastName} ${item?.firstName}`, subtitle:`${item?.email}`})"
                                                                            multiple>

                                                                        </VSelect>
                                                                    </VCol>



                                                                    <VCol cols="12" lg="12" class="text-right">
                                                                        <v-btn color="error"
                                                                            @click="setAddRepresentativeDialog(false)"
                                                                            variant="text">Cancel</v-btn>

                                                                        <v-btn color="primary" type="submit"
                                                                            :loading="loading" :disabled="!valid"
                                                                            @click="sendRepresentatives">
                                                                            <span v-if="!loading">
                                                                                Save
                                                                            </span>
                                                                            <clip-loader v-else :loading="loading"
                                                                                color="white"
                                                                                :size="'25px'"></clip-loader>
                                                                        </v-btn>

                                                                    </VCol>
                                                                </VRow>
                                                            </VForm>
                                                        </v-card-text>
                                                    </v-card>
                                                </v-dialog>
                                            </v-sheet>
                                        </v-col>

                                        <v-col cols="12">
                                            <v-table>
                                                <thead>
                                                    <tr>
                                                        <th class="text-left">
                                                            #
                                                        </th>
                                                        <th class="text-left">
                                                            Full Name
                                                        </th>
                                                        <th class="text-left">
                                                            Email
                                                        </th>
                                                        <th class="text-left">
                                                            Position
                                                        </th>
                                                        <th class="text-left">
                                                            Action
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    
                                                    <template v-if="isAuditingOrg">
                                                        <tr v-for="(member, index) in getAuditors"
                                                            :key="member">
                                                            <td>{{ ++index }}</td>
                                                            <td>{{ `${member?.member?.lastName}
                                                                ${member?.member?.firstName}` }}</td>
                                                            <td>{{ `${member?.member?.email}` }}</td>
                                                            <td>{{ `${member?.position.split('_').join(' ')}` }}</td>
                                                            <td>
                                                                <v-btn color='error' size='small'
                                                                    @click="removeMember(member?.member?.id)">
                                                                    Remove
                                                                </v-btn>
                                                            </td>
                                                        </tr>
                                                    </template>
                                                    <template v-if="isAuditeeOrg">
                                                        <tr v-for="(member, index) in getRepresentatives"
                                                            :key="member">
                                                            <td>{{ ++index }}</td>
                                                            <td>{{ `${member?.member?.lastName}
                                                                ${member?.member?.firstName}` }}</td>
                                                            <td>{{ `${member?.member?.email}` }}</td>
                                                            <td>{{ `${member?.position.split('_').join(' ')}` }}</td>
                                                            <td>
                                                                <v-btn color='error' size='small'
                                                                    @click="removeMember(member?.member?.id)">
                                                                    Remove
                                                                </v-btn>
                                                            </td>
                                                        </tr>
                                                    </template>
                                                    
                                                </tbody>
                                            </v-table>
                                        </v-col>
                                    </v-row>

                                </div>

                                <v-row class="mt-3">
                                    <v-col cols="12" sm="6">
                                        
                                    </v-col>
                                    <v-col cols="12" sm="6" class="text-sm-right">
                                        <v-btn color="primary" @click="changeTab('tab-2')"
                                            v-if="isLoggedInUserIsLeadAuditor || isLoggedInUserIsLeadRepresentative">Next Step</v-btn>
                                    </v-col>
                                </v-row>
                            </v-window-item>
                            <v-window-item value="tab-2" class="pa-1">
                                
                                <div>
                                    <v-row class="mt-3 px-4">

                                        <v-col cols="12">

                                            <v-btn color="primary" @click="setRequestDocumentDialog(true)" class="mr-2"
                                                v-if="isAuditingOrg && isLoggedInUserIsLeadAuditor">Request Document</v-btn>

                                            <v-sheet>
                                                <v-dialog v-model="requestDocumentDialog" max-width="800">
                                                    <v-card>


                                                        <v-card-text>
                                                            <div class="d-flex justify-space-between">
                                                                <h3 class="text-h3">Request Document </h3>
                                                                <v-btn icon @click="setRequestDocumentDialog(false)"
                                                                    size="small" flat>
                                                                    <XIcon size="16" />
                                                                </v-btn>
                                                            </div>
                                                        </v-card-text>
                                                        <v-divider></v-divider>

                                                        <v-card-text>

                                                            <VForm v-model="valid" ref="formContainer" fast-fail
                                                                lazy-validation @submit.prevent="requestDocument" class="py-1">
                                                                <VRow class="mt-5 mb-3">

                                                                    <VCol cols="12" md="12">
                                                                        <v-label class="text-subtitle-1 font-weight-medium pb-1">Document Title</v-label>
                                                                        <VTextField type="text" variant="outlined" outlined name="Title"
                                                                            label="Title" v-model="stepTwoFields.title"
                                                                            :rules="stepTwoFieldRules.title" required
                                                                            :color="stepTwoFields.title.length > 3 ? 'success' : 'primary'">
                                                                        </VTextField>
                                                                    </VCol>
                                                                    <VCol cols="12" md="12">
                                                                        <v-label class="text-subtitle-1 font-weight-medium pb-1">Document Description</v-label>
                                                                        <VTextarea variant="outlined" outlined name="Description"
                                                                            label="Description" v-model="stepTwoFields.description"
                                                                            :rules="stepTwoFieldRules.description" required
                                                                            :color="stepTwoFields.description.length > 10 ? 'success' : 'primary'">
                                                                        </VTextarea>
                                                                    </VCol>



                                                                    <VCol cols="12" lg="12" class="text-right">
                                                                        <v-btn color="error"
                                                                            @click="setRequestDocumentDialog(false)"
                                                                            variant="text">Cancel</v-btn>

                                                                        <v-btn color="primary" type="submit"
                                                                            :loading="loading" :disabled="!valid"
                                                                            @click="requestDocument">
                                                                            <span v-if="!loading">
                                                                                Send
                                                                            </span>
                                                                            <clip-loader v-else :loading="loading"
                                                                                color="white"
                                                                                :size="'25px'"></clip-loader>
                                                                        </v-btn>

                                                                    </VCol>
                                                                </VRow>
                                                            </VForm>
                                                        </v-card-text>
                                                    </v-card>
                                                </v-dialog>
                                                <v-dialog v-model="sendDocumentDialog" max-width="800">
                                                    <v-card>


                                                        <v-card-text>
                                                            <div class="d-flex justify-space-between">
                                                                <h3 class="text-h3">Send Document </h3>
                                                                <v-btn icon @click="setSendDocumentDialog(false)"
                                                                    size="small" flat>
                                                                    <XIcon size="16" />
                                                                </v-btn>
                                                            </div>
                                                        </v-card-text>
                                                        <v-divider></v-divider>

                                                        <v-card-text>

                                                            <VForm v-model="valid" ref="formContainer" fast-fail
                                                                lazy-validation @submit.prevent="sendDocument" class="py-1">
                                                                <VRow class="mt-5 mb-3">

                                                                    <VCol cols="12" md="12">
                                                                        <v-label class="text-subtitle-1 font-weight-medium pb-1">Document Comment</v-label>
                                                                        <VTextarea variant="outlined" outlined name="Comments"
                                                                            label="Comments" v-model="stepTwoFields.comments"
                                                                            :rules="stepTwoFieldRules.comments" required
                                                                            :color="stepTwoFields.comments.length > 10 ? 'success' : 'primary'">
                                                                        </VTextarea>
                                                                    </VCol>
                                                                    <VCol cols="12" md="12">
                                                                        <v-label
                                                                            class="font-weight-medium pb-1">Files</v-label>

                                                                        <v-file-input :show-size="1000"
                                                                            color="deep-purple-accent-4"
                                                                            label="File input"
                                                                            placeholder="Select your files"
                                                                            prepend-icon="mdi-paperclip"
                                                                            variant="outlined" counter
                                                                            accept="image/*, .pdf" @change="selectImage">
                                                                            <template v-slot:selection="{ fileNames }">
                                                                                <template
                                                                                    v-for="(fileName, index) in fileNames"
                                                                                    :key="fileName">
                                                                                    <v-chip v-if="index < 2"
                                                                                        class="me-2"
                                                                                        color="deep-purple-accent-4"
                                                                                        size="small" label>
                                                                                        {{ fileName }}
                                                                                    </v-chip>

                                                                                    <span v-else-if="index === 2"
                                                                                        class="text-overline text-grey-darken-3 mx-2">
                                                                                        +{{ files.length - 2 }} File(s)
                                                                                    </span>
                                                                                </template>
                                                                            </template>
                                                                        </v-file-input>

                                                                        <!-- <div v-if="previewImage">
                                                                            <VRow>
                                                                                <VCol cols="4"
                                                                                    v-for="image in previewImage"
                                                                                    :key="image">

                                                                                    <div>
                                                                                        <img class="preview my-3"
                                                                                            :src="image" alt=""
                                                                                            style="max-width: 200px;" />
                                                                                    </div>
                                                                                </VCol>
                                                                            </VRow>
                                                                        </div> -->
                                                                    </VCol>



                                                                    <VCol cols="12" lg="12" class="text-right">
                                                                        <v-btn color="error"
                                                                            @click="setSendDocumentDialog(false)"
                                                                            variant="text">Cancel</v-btn>

                                                                        <v-btn color="primary" type="submit"
                                                                            :loading="loading" :disabled="!valid"
                                                                            @click="sendDocument">
                                                                            <span v-if="!loading">
                                                                                Send
                                                                            </span>
                                                                            <clip-loader v-else :loading="loading"
                                                                                color="white"
                                                                                :size="'25px'"></clip-loader>
                                                                        </v-btn>

                                                                    </VCol>
                                                                </VRow>
                                                            </VForm>
                                                        </v-card-text>
                                                    </v-card>
                                                </v-dialog>
                                                
                                                <v-dialog v-model="showRejectDialog" max-width="800">
                                                    <v-card>


                                                        <v-card-text>
                                                            <div class="d-flex justify-space-between">
                                                                <h3 class="text-h3">Reject Reason </h3>
                                                                <v-btn icon @click="setRejectReasonDialog(false)"
                                                                    size="small" flat>
                                                                    <XIcon size="16" />
                                                                </v-btn>
                                                            </div>
                                                        </v-card-text>
                                                        <v-divider></v-divider>

                                                        <v-card-text>

                                                            <VForm v-model="valid" ref="formContainer" fast-fail
                                                                lazy-validation @submit.prevent="actionDocument(stepTwoFields.document_id, 'rejected')" class="py-1">
                                                                <VRow class="mt-5 mb-3">

                                                                    <VCol cols="12" md="12">
                                                                        <v-label class="text-subtitle-1 font-weight-medium pb-1">Reason</v-label>
                                                                        <VTextarea variant="outlined" outlined name="Reason"
                                                                            label="Reason" v-model="stepTwoFields.reason"
                                                                            :rules="stepTwoFieldRules.reason" required
                                                                            :color="stepTwoFields.reason.length > 10 ? 'success' : 'primary'">
                                                                        </VTextarea>
                                                                    </VCol>



                                                                    <VCol cols="12" lg="12" class="text-right">
                                                                        <v-btn color="error"
                                                                            @click="setRejectReasonDialog(false)"
                                                                            variant="text">Cancel</v-btn>

                                                                        <v-btn color="primary" type="submit"
                                                                            :loading="loading" :disabled="!valid"
                                                                            @click="actionDocument(stepTwoFields.document_id, 'rejected')">
                                                                            <span v-if="!loading">
                                                                                Send
                                                                            </span>
                                                                            <clip-loader v-else :loading="loading"
                                                                                color="white"
                                                                                :size="'25px'"></clip-loader>
                                                                        </v-btn>

                                                                    </VCol>
                                                                </VRow>
                                                            </VForm>
                                                        </v-card-text>
                                                    </v-card>
                                                </v-dialog>
                                                

                                            </v-sheet>
                                        </v-col>

                                        <v-col cols="12">
                                            <v-table>
                                                <thead>
                                                    <tr>
                                                        <th class="text-left">
                                                            #
                                                        </th>
                                                        <th class="text-left">
                                                            Title
                                                        </th>
                                                        <th class="text-left">
                                                            Description
                                                        </th>
                                                        <th class="text-left">
                                                            Upload By
                                                        </th>
                                                        <th class="text-left">
                                                            Status
                                                        </th>
                                                        <th class="text-left">
                                                            File(s)
                                                        </th>
                                                        <th class="text-left">
                                                            Action
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    

                                                        <tr v-for="(document, index) in getDocuments"
                                                            :key="document">
                                                            <td>{{ ++index }}</td>
                                                            <td>{{ `${document?.title}` }}</td>
                                                            <td>{{ `${document?.description}` }}</td>
                                                            <td>{{ `${document?.recipient_user_id ? `${document?.uploaded_by?.lastName} ${document?.uploaded_by?.firstName}` : ''}` }}</td>
                                                            <td class="text-uppercase">{{ `${document?.status}` }}</td>
                                                            <td>
                                                                
                                                                <v-btn color='success' size='small' :href="document?.media?.full_url" v-if="document?.media && (document?.is_uploaded || document?.is_accepted)" flat target="_blank">
                                                                    View
                                                                </v-btn>
                                                            </td>
                                                            <td>
                                                                <v-btn color='error' size='small' class="mx-2"
                                                                    @click="revertDocument(document?.id)" v-if="isLoggedInUserIsLeadAuditor && (document?.is_pending || document?.is_rejected)">
                                                                    Revert
                                                                </v-btn>
                                                                <v-btn color='primary' size='small' class="mx-2"
                                                                    @click="actionDocument(document?.id, 'accepted')" v-if="isLoggedInUserIsLeadAuditor && (document?.is_uploaded)">
                                                                    Accept
                                                                </v-btn>
                                                                <v-btn color='error' size='small' class="mx-2"
                                                                    @click="setRejectReasonDialog(true, document?.id)" v-if="isLoggedInUserIsLeadAuditor && (document?.is_uploaded)">
                                                                    Reject
                                                                </v-btn>
                                                                <v-btn color='error' size='small' class="mx-2"
                                                                    @click="removeDocument(document?.id)" v-if="isLoggedInUserIsLeadRepresentative && (document?.is_uploaded)">
                                                                    Cancel
                                                                </v-btn>
                                                                <v-btn color='primary' size='small' class="mx-2"
                                                                    @click="setSendDocumentDialog(true, document?.id)"  v-if="isLoggedInUserIsLeadRepresentative && (document?.is_pending || document?.is_rejected)">
                                                                    Upload Files
                                                                </v-btn>
                                                                <v-btn color='primary' size='small' class="mx-2">
                                                                    Comment
                                                                </v-btn>
                                                            </td>
                                                        </tr>
                                                    
                                                    
                                                    
                                                </tbody>
                                            </v-table>
                                        </v-col>
                                    </v-row>

                                </div>
                                <v-row class="mt-3">
                                    <v-col cols="6">
                                        <v-btn color="primary" variant="tonal" @click="changeTab('tab-1')">Back</v-btn>
                                    </v-col>
                                    <v-col cols="6" class="text-right">
                                        <v-btn color="primary" @click="changeTab('tab-3')"
                                            v-if="isLoggedInUserIsLeadAuditor || isLoggedInUserIsLeadRepresentative">Next Step</v-btn>
                                    </v-col>
                                </v-row>
                            </v-window-item>
                            <v-window-item value="tab-3" class="pa-1">

                                <div>
                                    <v-row class="mt-3 px-4">
                                        <v-col cols="12">

                                            <v-btn color="primary" @click="setSendScheduleDialog(true)" class="mr-2"
                                            v-if="isLoggedInUserIsLeadAuditor && !getSchedule?.is_accepted">Send Onsite Schedule</v-btn>
                                            <v-btn color="primary" @click="setConfirmScheduleDialog(true)" class="mr-2"
                                            v-if="isLoggedInUserIsLeadRepresentative && !getSchedule?.is_accepted">Confirm Onsite Schedule</v-btn>
                                            <v-sheet>
                                                <v-dialog v-model="confirmScheduleDialog" max-width="800"  >
                                                    <v-card min-height="800">

                                                        <v-card-text>
                                                            <div class="d-flex justify-space-between">
                                                                <h3 class="text-h3">Add Schedule </h3>
                                                                <v-btn icon @click="setConfirmScheduleDialog(false)"
                                                                    size="small" flat>
                                                                    <XIcon size="16" />
                                                                </v-btn>
                                                            </div>
                                                        </v-card-text>
                                                        <v-divider></v-divider>

                                                        <v-card-text>
                                                            <VForm v-model="valid" ref="formContainer" fast-fail
                                                                lazy-validation @submit.prevent="actionAuditeeTime"
                                                                class="py-1">
                                                                <VRow class="mt-5 mb-3">

                                                                    <VCol cols="12" md="12">
                                                                        <v-label class="font-weight-medium pb-1">Select
                                                                            Dates</v-label>
                                                                        <VueDatePicker
                                                                            input-class-name="dp-custom-input"
                                                                            v-model="stepThreeFields.date_time"
                                                                            :min-date="new Date()"  required>
                                                                        </VueDatePicker>
                                                                    </VCol>



                                                                    <VCol cols="12" lg="12" class="text-right">

                                                                        <v-btn color="error"
                                                                            @click="setConfirmScheduleDialog(false)"
                                                                            variant="text">Cancel</v-btn>

                                                                        <v-btn color="primary" type="submit"
                                                                            :loading="loading" :disabled="!valid"
                                                                            @click="actionAuditeeTime">
                                                                            <span v-if="!loading">
                                                                                Send Schedule
                                                                            </span>
                                                                            <clip-loader v-else :loading="loading"
                                                                                color="white"
                                                                                :size="'25px'"></clip-loader>
                                                                        </v-btn>

                                                                    </VCol>
                                                                </VRow>
                                                            </VForm>

                                                        </v-card-text>
                                                    </v-card>
                                                </v-dialog>
                                                <v-dialog v-model="sendScheduleDialog" max-width="800"  >
                                                    <v-card min-height="800">

                                                        <v-card-text>
                                                            <div class="d-flex justify-space-between">
                                                                <h3 class="text-h3">Add Schedule </h3>
                                                                <v-btn icon @click="setSendScheduleDialog(false)"
                                                                    size="small" flat>
                                                                    <XIcon size="16" />
                                                                </v-btn>
                                                            </div>
                                                        </v-card-text>
                                                        <v-divider></v-divider>

                                                        <v-card-text>
                                                            <VForm v-model="valid" ref="formContainer" fast-fail
                                                                lazy-validation @submit.prevent="actionAuditorTime"
                                                                class="py-1">
                                                                <VRow class="mt-5 mb-3">

                                                                    <VCol cols="12" md="12">
                                                                        <v-label class="font-weight-medium pb-1">Select
                                                                            Dates</v-label>
                                                                        <VueDatePicker
                                                                            input-class-name="dp-custom-input"
                                                                            v-model="stepThreeFields.date_time"
                                                                            :min-date="new Date()"  required>
                                                                        </VueDatePicker>
                                                                    </VCol>



                                                                    <VCol cols="12" lg="12" class="text-right">

                                                                        <v-btn color="error"
                                                                            @click="setSendScheduleDialog(false)"
                                                                            variant="text">Cancel</v-btn>

                                                                        <v-btn color="primary" type="submit"
                                                                            :loading="loading" :disabled="!valid"
                                                                            @click="actionAuditorTime">
                                                                            <span v-if="!loading">
                                                                                Send Schedule
                                                                            </span>
                                                                            <clip-loader v-else :loading="loading"
                                                                                color="white"
                                                                                :size="'25px'"></clip-loader>
                                                                        </v-btn>

                                                                    </VCol>
                                                                </VRow>
                                                            </VForm>

                                                        </v-card-text>
                                                    </v-card>
                                                </v-dialog>
                                            </v-sheet>
                                        </v-col>

                                        <v-col cols="12">
                                            <v-table>
                                                <thead>
                                                    <tr>

                                                        <th class="text-left">
                                                            #
                                                        </th>
                                                        <th class="text-left">
                                                            Auditor Time
                                                        </th>
                                                        <th class="text-left">
                                                            Representative TIme
                                                        </th>
                                                        <th class="text-left">
                                                            Time Accepted
                                                        </th>
                                                        <th class="text-left">
                                                            Action
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td></td>
                                                        <td>
                                                            {{ `${getSchedule?.auditor_time ? getSchedule?.auditor_time : ""}` }}
                                                            
                                                                <v-btn color='primary' size='small'
                                                                    @click="actionAcceptedTime('auditor')" v-if="isLoggedInUserIsLeadAuditor && !getSchedule?.is_accepted && getSchedule?.auditor_time && getSchedule?.recipient_time">
                                                                    Accept
                                                                </v-btn>
                                                        </td>
                                                        <td>
                                                            {{ `${getSchedule?.recipient_time ? getSchedule?.recipient_time : ""}` }}
                                                                <v-btn color='primary' size='small'
                                                                    @click="actionAcceptedTime('recipient')" v-if="isLoggedInUserIsLeadAuditor && !getSchedule?.is_accepted && getSchedule?.auditor_time && getSchedule?.recipient_time">
                                                                    Accept
                                                                </v-btn>
                                                        </td>
                                                        <td>
                                                            {{ `${getSchedule?.accepted_time ? getSchedule?.accepted_time : ""}` }}
                                                        </td>
                                                        <td>{{ `Start Onsite` }}</td>
                                                    </tr>
                                                </tbody>
                                            </v-table>
                                        </v-col>
                                    </v-row>

                                </div>
                                <v-row class="mt-3">
                                    <v-col cols="6">
                                        <v-btn color="primary" variant="tonal" @click="changeTab('tab-2')">Back</v-btn>
                                    </v-col>
                                    <v-col cols="6" class="text-right">
                                        <v-btn color="primary" @click="changeTab('tab-4')"
                                            v-if="isLoggedInUserIsLeadAuditor || isLoggedInUserIsLeadRepresentative">Next Step</v-btn>
                                    </v-col>
                                </v-row>
                            </v-window-item>
                            <v-window-item value="tab-4" class="pa-1">

                                <div>
                                    <v-row class="mt-3 px-4">


                                        <v-col cols="12">
                                            
                                            <v-window v-model="questionTab" class="customTab">
                                                <template v-if="getQuestions.length > 0">
                                                    <v-window-item  v-for="(title_question, index) in getQuestions" :key="title_question" :value="`questionTab-${index}`" class="pa-1">

                                                        <div>
                                                            <v-row class="mt-3 px-4">

                                                                <v-col cols="12">


                                                                    <v-sheet>
                                                                        <v-dialog v-model="sendCommentDialog" max-width="800">
                                                                            <v-card>


                                                                                <v-card-text>
                                                                                    <div class="d-flex justify-space-between">
                                                                                        <h3 class="text-h3">Send Comment </h3>
                                                                                        <v-btn icon @click="setSendCommentDialog(false)"
                                                                                            size="small" flat>
                                                                                            <XIcon size="16" />
                                                                                        </v-btn>
                                                                                    </div>
                                                                                </v-card-text>
                                                                                <v-divider></v-divider>

                                                                                <v-card-text>

                                                                                    <VForm v-model="valid" ref="formContainer" fast-fail
                                                                                        lazy-validation @submit.prevent="auditSendComment" class="py-1">
                                                                                        <VRow class="mt-5 mb-3">

                                                                                            <VCol cols="12" md="12">
                                                                                                <v-label class="text-subtitle-1 font-weight-medium pb-1">Comments</v-label>
                                                                                                <VTextarea variant="outlined" outlined name="Comment"
                                                                                                    label="Comment" v-model="stepFourFields.comments"
                                                                                                    :rules="stepFourFieldRules.comments" required
                                                                                                    :color="stepFourFields.comments.length > 10 ? 'success' : 'primary'">
                                                                                                </VTextarea>
                                                                                            </VCol>



                                                                                            <VCol cols="12" lg="12" class="text-right">
                                                                                                <v-btn color="error"
                                                                                                    @click="setSendCommentDialog(false)"
                                                                                                    variant="text">Cancel</v-btn>

                                                                                                <v-btn color="primary" type="submit"
                                                                                                    :loading="loading" :disabled="!valid"
                                                                                                    @click="auditSendComment">
                                                                                                    <span v-if="!loading">
                                                                                                        Send
                                                                                                    </span>
                                                                                                    <clip-loader v-else :loading="loading"
                                                                                                        color="white"
                                                                                                        :size="'25px'"></clip-loader>
                                                                                                </v-btn>

                                                                                            </VCol>
                                                                                        </VRow>
                                                                                    </VForm>
                                                                                </v-card-text>
                                                                            </v-card>
                                                                        </v-dialog>
                                                                    </v-sheet>
                                                                </v-col>
                                                                
                                                                <v-col cols="12">
                                                                    <h2>{{title_question.title}}</h2>
                                                                    <v-table>
                                                                        <thead>
                                                                            <tr>
                                                                                <th class="text-left">
                                                                                    Questions
                                                                                </th>
                                                                                <th class="text-left"  width="10%">
                                                                                    Yes
                                                                                </th>
                                                                                <th class="text-left"  width="10%">
                                                                                    NC Minor
                                                                                </th>
                                                                                <th class="text-left"  width="10%">
                                                                                    NC Major
                                                                                </th>
                                                                                <th class="text-left"  width="10%">
                                                                                    NA
                                                                                </th>
                                                                                <th class="text-left">
                                                                                    Comments / Audit Evidence
                                                                                </th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <!-- {{ title_question.questions }} -->
                                                                            <!-- <template> -->
                                                                                <tr v-for="(question) in title_question.questions" :key="question">
                                                                                    <!-- <td>{{ ++index }}</td> -->
                                                                                    <td>{{ `${question?.question}` }}</td>
                                                                                    <td>
                                                                                        
                                                                                        <v-btn  v-if="question?.answer ? question?.answer == 'yes' : question?.response?.answer == 'yes'" color='success' size='small' flat >
                                                                                            selected
                                                                                        </v-btn>
                                                                                        <v-btn  v-else color='primary' size='small' flat  @click="auditSendResponse(question?.id, 'yes', title_question.id)" >
                                                                                            select
                                                                                        </v-btn>
                                                                                    </td>
                                                                                    <td>
                                                                                                            
                                                                                        <v-btn  v-if="question?.answer ? question?.answer == 'nc_minor' : question?.response?.answer == 'nc_minor'" color='success' size='small' flat >
                                                                                            selected
                                                                                        </v-btn>
                                                                                        <v-btn  v-else color='primary' size='small' flat  @click="auditSendResponse(question?.id, 'nc_minor', title_question.id)" >
                                                                                            select
                                                                                        </v-btn>
                                                                                    </td>
                                                                                    <td>
                                                                                        
                                                                                        <v-btn  v-if="question?.answer ? question?.answer == 'nc_major' : question?.response?.answer == 'nc_major'" color='success' size='small' flat >
                                                                                            selected
                                                                                        </v-btn>
                                                                                        <v-btn  v-else color='primary' size='small' flat  @click="auditSendResponse(question?.id, 'nc_major', title_question.id)" >
                                                                                            select
                                                                                        </v-btn>
                                                                                    </td>
                                                                                    <td>
                                                                                        <v-btn  v-if="question?.answer ? question?.answer == 'na' : question?.response?.answer == 'na'" color='success' size='small' flat >
                                                                                            selected
                                                                                        </v-btn>
                                                                                        <v-btn  v-else color='primary' size='small' flat  @click="auditSendResponse(question?.id, 'na', title_question.id)" >
                                                                                            select
                                                                                        </v-btn>
                                                                                    </td>
                                                                                    <td>
                                                                                        
                                                                                        <v-btn color='primary' size='small' @click="setSendCommentDialog(true, question?.id, title_question.id, question)" flat >
                                                                                            {{ question?.comment || question?.response?.comment ? 'Edit Comment'  : "Add Comment" }}
                                                                                        </v-btn>
                                                                                    </td>
                                                                                </tr>
                                                                            <!-- </template> -->
                                                                            
                                                                            
                                                                        </tbody>
                                                                    </v-table>
                                                                </v-col>
                                                                
                                                            </v-row>

                                                        </div>

                                                        <v-row class="mt-3">
                                                            <v-col cols="12" sm="6">
                                                                <v-btn color="primary" variant="tonal" @click="changeQuestionTab(`questionTab-${index-1}`)" v-if="index > 0">Previous Questions</v-btn>
                                                            </v-col>
                                                            <v-col cols="12" sm="6" class="text-sm-right">
                                                                <v-btn color="primary"  @click="changeQuestionTab(`questionTab-${index+1}`)"  >Next Questions</v-btn>
                                                            </v-col>
                                                        </v-row>
                                                    </v-window-item>    
                                                </template>
                                                
                                            </v-window>
                                            
                                        </v-col>
                                    </v-row>

                                </div>
                                <v-row class="mt-3">
                                    <v-col cols="6">
                                        <v-btn color="primary" variant="tonal" @click="changeTab('tab-3')">Back</v-btn>
                                    </v-col>
                                    <v-col cols="6" class="text-right">
                                        <v-btn color="primary" @click="changeTab('tab-5')"
                                            v-if="isLoggedInUserIsLeadAuditor || isLoggedInUserIsLeadRepresentative">Next Step</v-btn>
                                    </v-col>
                                </v-row>
                            </v-window-item>
                            <v-window-item value="tab-5" class="pa-1">
                                <div>
                                    <v-row class="mt-3 px-4">
                                        
                                        
                                        <v-col cols="12">
                                            <v-btn  color="primary"  @click="setViewFindingDialog(true)" class="mr-2">Add Finding</v-btn>
                                            
                                            <v-sheet>
                                                <v-dialog v-model="viewFindingDialog" max-width="700">
                                                    <v-card>

                                                        <v-card-text>
                                                            <div class="d-flex justify-space-between">
                                                                <h3 class="text-h3">Add </h3>
                                                                <v-btn icon @click="setViewFindingDialog(false)" size="small" flat>
                                                                    <XIcon size="16" />
                                                                </v-btn>
                                                            </div>
                                                        </v-card-text>
                                                        <v-divider></v-divider>

                                                        <v-card-text>

                                                            <VForm v-model="valid" ref="formContainer" fast-fail lazy-validation
                                                                @submit.prevent="sendFindings" class="py-1">
                                                                <VRow class="mt-5 mb-3">

                                                                    <VCol cols="12" md="12">
                                                                        <v-label class="text-subtitle-1 font-weight-medium pb-1">Details</v-label>
                                                                        <VTextarea variant="outlined" outlined name="Description"
                                                                            label="Details" v-model="stepFiveFields.detail"
                                                                            :rules="stepFiveFieldRules.detail" required
                                                                            :color="stepFiveFields.detail.length > 10 ? 'success' : 'primary'">
                                                                        </VTextarea>
                                                                    </VCol>
                                                                    <VCol cols="12" lg="12" class="text-right">
                                                                        <v-btn color="error" @click="setViewFindingDialog(false)"
                                                                            variant="text">Cancel</v-btn>

                                                                        <v-btn color="primary" type="submit" :loading="loading"
                                                                            :disabled="!valid" @click="sendFindings">
                                                                            <span v-if="!loading">
                                                                                Submit
                                                                            </span>
                                                                            <clip-loader v-else :loading="loading" color="white"
                                                                                :size="'25px'"></clip-loader>
                                                                        </v-btn>

                                                                    </VCol>
                                                                </VRow>
                                                            </VForm>
                                                        </v-card-text>
                                                    </v-card>
                                                </v-dialog>
                                            </v-sheet>
                                        </v-col>
                                        
                                        <v-col cols="12" >
                                            <v-table>
                                                <thead>
                                                    <tr>
                                                        
                                                        <th class="text-left">
                                                            Auditor
                                                        </th>
                                                        <th class="text-left">
                                                            Description
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>{{ getFindings ? `${getFindings?.user?.lastName} ${getFindings?.user?.firstName}` : '' }}</td>
                                                        <td>{{ getFindings ? `${getFindings?.description}` : '' }}</td>
                                                    </tr>
                                                </tbody>
                                            </v-table>
                                        </v-col>
                                    </v-row>

                                    <v-row class="mt-3 px-4">


                                        <v-col cols="12">
                                            <v-btn color="primary" @click="setViewRecommendationDialog(true)"
                                                class="mr-2">Add Corrective Action</v-btn>

                                            <v-sheet>
                                                <v-dialog v-model="viewRecommendationDialog" max-width="500">
                                                    <v-card>

                                                        <v-card-text>
                                                            <div class="d-flex justify-space-between">
                                                                <h3 class="text-h3">Add </h3>
                                                                <v-btn icon @click="setViewRecommendationDialog(false)"
                                                                    size="small" flat>
                                                                    <XIcon size="16" />
                                                                </v-btn>
                                                            </div>
                                                        </v-card-text>
                                                        <v-divider></v-divider>

                                                        <v-card-text>

                                                            <VForm v-model="valid" ref="formContainer" fast-fail
                                                                lazy-validation @submit.prevent="sendRecommendation"
                                                                class="py-1">
                                                                <VRow class="mt-5 mb-3">

                                                                    <VCol cols="12" md="12">
                                                                        <v-label
                                                                            class="text-subtitle-1 font-weight-medium pb-1">Title</v-label>
                                                                        <VTextField type="text"
                                                                            v-model="stepFiveFields.title"
                                                                            :rules="stepFiveFieldRules.title" required
                                                                            variant="outlined" label="Title"
                                                                            :color="stepFiveFields.title.length > 2 ? 'success' : 'primary'">
                                                                        </VTextField>
                                                                    </VCol>
                                                                    <VCol cols="12" md="12">
                                                                        <v-label
                                                                            class="text-subtitle-1 font-weight-medium pb-1">Description</v-label>
                                                                        <VTextarea variant="outlined" outlined
                                                                            name="Description" label="Description"
                                                                            v-model="stepFiveFields.description"
                                                                            :rules="stepFiveFieldRules.description"
                                                                            required
                                                                            :color="stepFiveFields.description.length > 10 ? 'success' : 'primary'">
                                                                        </VTextarea>
                                                                    </VCol>
                                                                    <VCol cols="12" md="12">
                                                                        <v-label
                                                                            class="font-weight-medium pb-1">User</v-label>
                                                                            

                                                                        <VSelect v-model="stepFiveFields.assigneeId"
                                                                            :items="isLoggedInUserIsLeadAuditor ? getAuditMembers : getAuditeeMembers"
                                                                            :rules="stepFiveFieldRules.assigneeId"
                                                                            label="Select" :selected="''"
                                                                            item-title='lastName' item-value="uuid"
                                                                            single-line variant="outlined"
                                                                            class="text-capitalize"
                                                                            :item-props="(item) => ({title:`${item?.lastName} ${item?.firstName}`, subtitle:`${item?.email}`})">

                                                                        </VSelect>
                                                                    </VCol>
                                                                    <VCol cols="12" md="12">
                                                                        <v-label
                                                                            class="font-weight-medium pb-1">Severity</v-label>
                                                                        <VSelect v-model="stepFiveFields.priorityId"
                                                                            :items="getPriorities"
                                                                            :rules="stepFiveFieldRules.priorityId"
                                                                            label="Select" :selected="''"
                                                                            item-title="description" item-value="id"
                                                                            single-line variant="outlined"
                                                                            class="text-capitalize">
                                                                        </VSelect>
                                                                    </VCol>

                                                                    <VCol cols="12" md="6">
                                                                        <v-label
                                                                            class="text-subtitle-1 font-weight-medium pb-1">Start
                                                                            Date</v-label>
                                                                        <VueDatePicker
                                                                            input-class-name="dp-custom-input"
                                                                            v-model="stepFiveFields.start_date"
                                                                            :min-date="new Date()" required>
                                                                        </VueDatePicker>
                                                                    </VCol>
                                                                    <VCol cols="12" md="6">
                                                                        <v-label
                                                                            class="text-subtitle-1 font-weight-medium pb-1">End
                                                                            Date</v-label>
                                                                        <VueDatePicker
                                                                            input-class-name="dp-custom-input"
                                                                            :disabled='!stepFiveFields.start_date'
                                                                            v-model="stepFiveFields.end_date"
                                                                            :min-date="stepFiveFields.start_date ? new Date(stepFiveFields.start_date) : new Date()"
                                                                            required></VueDatePicker>
                                                                    </VCol>

                                                                    <VCol cols="12" lg="12" class="text-right">
                                                                        <v-btn color="error" @click="dialog = false"
                                                                            variant="text">Cancel</v-btn>

                                                                        <v-btn color="primary" type="submit"
                                                                            :loading="loading" :disabled="!valid"
                                                                            @click="sendRecommendation">
                                                                            <span v-if="!loading">
                                                                                Submit
                                                                            </span>
                                                                            <clip-loader v-else :loading="loading"
                                                                                color="white"
                                                                                :size="'25px'"></clip-loader>
                                                                        </v-btn>

                                                                    </VCol>
                                                                </VRow>
                                                            </VForm>
                                                        </v-card-text>
                                                    </v-card>
                                                </v-dialog>

                                            </v-sheet>
                                        </v-col>

                                        <v-col cols="12">
                                            <v-table>
                                                <thead>
                                                    <tr>

                                                        <th class="text-left">
                                                            #
                                                        </th>
                                                        <th class="text-left">
                                                            Title
                                                        </th>
                                                        <th class="text-left">
                                                            Description
                                                        </th>
                                                        <th class="text-left">
                                                            Assignee
                                                        </th>
                                                        <th class="text-left">
                                                            Status
                                                        </th>
                                                        <th class="text-left">
                                                            Priority
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr v-for="(actions, index) in getActions"
                                                        :key="actions">
                                                        <td>{{ ++index }}</td>
                                                        <td>{{ `${actions?.title}` }}</td>
                                                        <td>{{ `${actions?.description}` }}</td>
                                                        <td>{{ `${actions?.assignee?.lastName}
                                                            ${actions?.assignee?.firstName}` }}</td>
                                                        <td>{{ `${actions?.status}` }}</td>
                                                        <td>{{ `${actions?.priority?.description}` }}</td>
                                                    </tr>
                                                </tbody>
                                            </v-table>
                                        </v-col>
                                    </v-row>

                                </div>
                                <v-row class="mt-3">
                                    <v-col cols="6">
                                        <v-btn color="primary" variant="tonal" @click="changeTab('tab-4')">Back</v-btn>
                                    </v-col>
                                    <v-col cols="12" sm="6" class="text-sm-right">
                                        <v-btn color="primary" @click="completeAudit"
                                            v-if="isLoggedInUserIsLeadAuditor">Close Audit</v-btn>

                                    </v-col>
                                    
                                </v-row>
                                
                            </v-window-item>
                        </v-window>
                    </v-card-text>
                </UiParentCard>

            </v-col>

        </v-row>
    </div>
</template>
<style lang="scss">
.customTab {
    min-height: 68px;
}
</style>

