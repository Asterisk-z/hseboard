<script setup lang="ts">
import { ref, onMounted, computed, watch } from 'vue';
import { useRoute } from 'vue-router'
import { router } from '@/router';

import BaseBreadcrumb from '@/components/shared/BaseBreadcrumb.vue';
import UiParentCard from '@/components/shared/UiParentCard.vue';
import { useOrganizationStore } from '@/stores/organizationStore';
import { useAuthStore } from '@/stores/auth';
import { useOpenLinksStore } from '@/stores/openLinks';
import { useInspectionStore } from '@/stores/inspectionStore';
import moment from 'moment'
import Swal from 'sweetalert2'


const page = ref({ title: 'Ongoing Inspection' });
const breadcrumbs = ref([
    {
        text: 'Dashboard',
        disabled: false,
        href: '/dashboard'
    },
    {
        text: 'Inspection',
        disabled: false,
        href: '/inspections'
    },
    {
        text: 'Ongoing',
        disabled: true,
        href: '#'
    }
]);

const route = useRoute()
const authStore = useAuthStore();
const organizationStore = useOrganizationStore();
const openLinks = useOpenLinksStore();
const inspectionStore = useInspectionStore();


onMounted(() => {
    inspectionStore.getOngoingInspection(route.params.inspection_id as string)

    openLinks.getPriorities();
});


const getPriorities : any  = computed(() => (openLinks.priorities));

const computedIndex = (index : any) => ++index;

const getAuthUser : any   = computed(() => (authStore.loggedUser));
const getOngoingInspection : any   = computed(() => (inspectionStore.ongoingInspection));
const getActiveOrg : any   = computed(() => (organizationStore.getActiveOrg()));
const isLoggedInUserOwnsActionOrg : any   = computed(() => (getAuthUser.value?.id == getActiveOrg.value?.user_id));
const isInspecteeOrg : any   = computed(() => (getOngoingInspection.value?.recipient_organization_id == getActiveOrg.value?.id));
const isInspectingOrg : any   = computed(() => (getOngoingInspection.value?.organization_id == getActiveOrg.value?.id));
const isSameOrg : any   = computed(() => (getOngoingInspection.value?.organization_id == getOngoingInspection.value?.recipient_organization_id));

const getInspectingMembers : any   = computed(() => (inspectionStore.inspectingMembers));
const getInspecteeMembers : any   = computed(() => (inspectionStore.inspecteeMembers));

watch(
  () => isInspectingOrg.value,
  (value) => {
    if(value) {  
        inspectionStore.getInspectingMembers(route.params.inspection_id as string)
    }
    
      if (getOngoingInspection.value.is_pending) {
        Swal.fire({
            title: 'Info!',
            text: 'Organization is yet to accept Inspection?',
            icon: 'info',
            confirmButtonText: 'Ok',
            showCancelButton: false,
            allowOutsideClick: false,
        }).then((result) => {
            
        });
    }
  }
)
watch(
  () => isInspecteeOrg.value,
  (value) => {
      if (value) {
        inspectionStore.getInspecteeMembers(route.params.inspection_id as string)
    }
      if (getOngoingInspection.value.is_pending) {
        Swal.fire({
            title: 'Info!',
            text: `${getOngoingInspection.value?.organization?.name} sent a request to inspect your organization, do you accept or reject`,
            icon: 'info',
            confirmButtonText: 'Accept',
            cancelButtonText: 'Reject',
            showCancelButton: true,
            allowOutsideClick: false,
        }).then((result) => {
            
                
        
                let objectValues = {
                    "organization_id": getActiveOrg.value?.uuid,
                    "inspection_id": getOngoingInspection.value?.uuid,
                    "action": result.isConfirmed ? 'accepted' : 'rejected',
                    "reason":  'reason',
                }
                        
            inspectionStore.actionInspection(objectValues)
                    .catch((error: any) => {
                        throw error
                    })
                    .then((resp: any) => {
                         inspectionStore.getOngoingInspection(route.params.inspection_id as string);
                        return resp
                    });



        });
    }
  }
)

//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------




const valid = ref(true);;
const formContainer = ref()
const loading = ref(false);
const setLoading = (value: boolean) => {
    loading.value = value;
}


const addInspectorsDialog = ref(false);
const setAddInspectorsDialog = (value: boolean) => {
    addInspectorsDialog.value = value;
}
const addRepresentativeDialog = ref(false);
const setAddRepresentativeDialog = (value: boolean) => {
    addRepresentativeDialog.value = value;
}


const viewReportDialog = ref(false);
const setViewReportDialog = (value: boolean) => {
    viewReportDialog.value = value;
}
const addInviteDialog = ref(false);
const setAddInviteDialog = (value: boolean) => {
    addInviteDialog.value = value;
}
const addMemberDialog = ref(false);
const setAddMemberDialog = (value: boolean) => {
    addMemberDialog.value = value;
}
const viewQuestionTeamDialog = ref(false);
const setSelectQuestionaireTeam = (value: boolean) => {
    viewQuestionTeamDialog.value = value;
}

const viewQuestionDialog = ref(false);
const setViewQuestionDialog = (value: boolean) => {
    viewQuestionDialog.value = value;
    if (value == false) selectItem({})
}
const viewFindingDialog = ref(false);
const setViewFindingDialog = (value: boolean, type: string = '') => {
    viewFindingDialog.value = value;
    stepFourFields.value.type = type;
    if (value == false) selectItem({})
}
const viewRecommendationDialog = ref(false);
const setViewRecommendationDialog = (value: boolean, type: string = '') => {
    viewRecommendationDialog.value = value;
    if (value == false) selectItem({})
}
const selectedItem = ref({} as any);
const selectItem = (item: any, action: string = '', extra: any = '') => {
    selectedItem.value = Object.assign({}, item.raw);

    switch (action) {
        case 'viewQuestion':
            setViewQuestionDialog(true)
            break;
        case 'viewFinding':
            setViewFindingDialog(true, extra)
            break;
        case 'viewRecommendation':
            setViewFindingDialog(true)
            break;
        // case 'edit':

        //     setEditDialog(true)
        //     break;
        // case 'delete':
        //     setDeleteDialog(true)
        //     break;
        default:
            break;
    }

}

//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
const fields = ref({

    leadInspector: '',
    inspectorMembers: [],

    leadRepresentative: '',
    representatives: [],

    organization_id: getActiveOrg.value?.uuid,
});



const filteredLeadInspector : any  = computed(() => (getInspectingMembers.value?.filter((member: any) => (member.id != fields.value?.leadInspector))));

const getRepresentatives : any  = computed(() => (getOngoingInspection.value?.all_representatives));
const getInspectors : any  = computed(() => (getOngoingInspection.value?.all_inspectors));

const filteredgetInspecteeMembers : any  = computed(() => (getInspecteeMembers.value?.filter((member: any) => (member.id != fields.value?.leadRepresentative  && member.id != getOngoingInspection.value?.lead_inspector?.user_id))));

const isLoggedInUserIsleadInspector= computed(() => (getAuthUser.value?.id == getOngoingInspection.value?.lead_inspector?.member?.id));
const isLoggedInUserIsLeadRepresentative= computed(() => (getAuthUser.value?.id == getOngoingInspection.value?.lead_representative?.member?.id));

const fieldRules: any = ref({
    leadInspector: [
        (v: number) => !!v || 'Field is Required',
    ],
    inspectorMembers: [
        (v: number) => !!v || 'Field is Required',
    ],
    leadRepresentative: [
        (v: number) => !!v || 'Field is Required',
    ],
    representatives: [
        (v: number) => !!v || 'Field is Required',
    ],
    leadInvestigator: [
        (v: number) => !!v || 'Field is Required',
    ],
    teamMember: [
        (v: number) => !!v || 'Field is Required',
    ],
    groupChatName: [
        (v: string) => !!v || 'Field is Required',
    ],
})


const sendInspectors = async (e: any) => {
    e.preventDefault();

    try {
        setLoading(true)

        const values = { ...fields.value }
        
        
        
        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "inspection_id": getOngoingInspection.value?.uuid,
            "lead_inspector": values?.leadInspector,
            "team_members":  values?.inspectorMembers,
        }

        const resp = await inspectionStore.setInspectors(objectValues)
            .catch((error: any) => {
                console.log(error)
                throw error
            })
            .then((resp: any) => {
                return resp
            });

        if (resp?.message == 'success') {
            setLoading(false)
            setAddInspectorsDialog(false)
            inspectionStore.getOngoingInspection(route.params.inspection_id as string);
        }

        setLoading(false)
        setAddInspectorsDialog(false)



    } catch (error) {
        console.log(error)
        setLoading(false)
        setAddInspectorsDialog(false)
    }

}

const sendRepresentatives = async (e: any) => {
    e.preventDefault();

    try {
        setLoading(true)

        const values = { ...fields.value }
        
        
        
        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "inspection_id": getOngoingInspection.value?.uuid,
            "lead_representative": values?.leadRepresentative,
            "team_representatives":  values?.representatives,
        }

        const resp = await inspectionStore.setRepresentatives(objectValues)
            .catch((error: any) => {
                console.log(error)
                throw error
            })
            .then((resp: any) => {
                return resp
            });

        if (resp?.message == 'success') {
            setLoading(false)
            setAddRepresentativeDialog(false)
            inspectionStore.getOngoingInspection(route.params.inspection_id as string);
        }

        setLoading(false)
        setAddRepresentativeDialog(false)



    } catch (error) {
        console.log(error)
        setLoading(false)
        setAddRepresentativeDialog(false)
    }

}

const removeMember = async (member: any) => {

    try {
        setLoading(true)
        
        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "inspection_id": getOngoingInspection.value?.uuid,
            "team_member":  member
        }
        
        Swal.fire({
            title: 'Info!',
            text: 'Do you want to remove member?',
            icon: 'info',
            confirmButtonText: 'Yes',
            cancelButtonText: 'No',
            showCancelButton: true,
            allowOutsideClick: false,
        }).then((result) => {
            if (result.isConfirmed) {
                
                
                inspectionStore.removeMember(objectValues)
                    .catch((error: any) => {
                        throw error
                    })
                    .then((resp: any) => {
                         inspectionStore.getOngoingInspection(route.params.inspection_id as string);
                        return resp
                    });


            }
        });


        setLoading(false)

    } catch (error) {
        console.log(error)
        setLoading(false)
    }

}
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------

const updateInspectionDialog = ref(false);
const setUpdateInspectionDialog = (value: boolean) => {
    updateInspectionDialog.value = value;
}

const stepDetailFields = ref({
    name: getOngoingInspection.value.facility_name || '',
    location: getOngoingInspection.value.location || '',
    description: getOngoingInspection.value.description || '',
    objective: getOngoingInspection.value.objective || '',
    ppe: getOngoingInspection.value.ppe || '',
    organization_id: getActiveOrg.value?.uuid,
});

const stepDetailFieldRules: any = ref({
    name: [
        (v: string) => !!v || 'Field is Required',
    ],
    location: [
        (v: string) => !!v || 'Field is Required',
    ],
    description: [
        (v: string) => !!v || 'Field is Required',
    ],
    objective: [
        (v: string) => !!v || 'Field is Required',
    ],
    ppe: [
        (v: string) => !!v || 'Field is Required',
    ],
})

watch(
    () => getOngoingInspection.value,
    (value) => {


        if (getOngoingInspection.value.facility_name) {
            stepDetailFields.value.name = getOngoingInspection.value.facility_name
            stepDetailFields.value.location = getOngoingInspection.value.location
            stepDetailFields.value.description = getOngoingInspection.value.description
            stepDetailFields.value.objective = getOngoingInspection.value.objective
            stepDetailFields.value.ppe = getOngoingInspection.value.ppe
        }
    }
)

const updateInspectionDetails = async (e: any) => {
    e.preventDefault();

    try {
        setLoading(true)

        const values = { ...stepDetailFields.value }


        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "inspection_id": getOngoingInspection.value?.uuid,
            "name" : values?.name,
            "location" : values?.location,
            "description" : values?.description,
            "objective" : values?.objective,
            "ppe" : values?.ppe
        }

        const resp = await inspectionStore.updateDetailInspection(objectValues)
            .catch((error: any) => {
                console.log(error)
                throw error
            })
            .then((resp: any) => {
                return resp
            });

        if (resp?.message == 'success') {
            setLoading(false)

            setUpdateInspectionDialog(false)
            inspectionStore.getOngoingInspection(route.params.inspection_id as string);
        }

        setLoading(false)
        setUpdateInspectionDialog(false)



    } catch (error) {
        console.log(error)
        setUpdateInspectionDialog(false)

        setLoading(false)
    }

}

const proceedInspection = async (member: any) => {

    try {
        setLoading(true)
        
        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "inspection_id": getOngoingInspection.value?.uuid,
        }
        
        Swal.fire({
            title: 'Info!',
            text: 'Do you want to proceed?',
            icon: 'info',
            confirmButtonText: 'Yes',
            cancelButtonText: 'No',
            showCancelButton: true,
            allowOutsideClick: false,
        }).then((result) => {
            if (result.isConfirmed) {
                
                
                inspectionStore.proceedInspection(objectValues)
                    .catch((error: any) => {
                        throw error
                    })
                    .then((resp: any) => {
                         inspectionStore.getOngoingInspection(route.params.inspection_id as string);
                        return resp
                    });


            }
        });


        setLoading(false)

    } catch (error) {
        console.log(error)
        setLoading(false)
    }

}
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------


const requestDocumentDialog = ref(false);
const setRequestDocumentDialog = (value: boolean) => {
    requestDocumentDialog.value = value;
}

const sendDocumentDialog = ref(false);
const setSendDocumentDialog = (value: boolean, item_id : any = '') => {
    sendDocumentDialog.value = value;
    stepTwoFields.value.document_id = item_id
}

const showRejectDialog = ref(false);
const setRejectReasonDialog = (value: boolean, item_id : any = '') => {
    showRejectDialog.value = value;
    stepTwoFields.value.document_id = item_id
}


const stepTwoFields = ref({
    title: "",
    document_id: "",
    description: "",
    comments: "",
    reason: "",
    files: '',

});




const files = ref([])
const images = ref([])
const previewImage = ref([] as any)

const selectImage = (image: any) => {
    stepTwoFields.value.files =  image.target.files
    images.value = image.target.files;
    previewImage.value = [];

    for (let index = 0; index < images.value.length; index++) {
        const element = images.value[index];
        previewImage.value.push(URL.createObjectURL(element) as string)
    }

}


//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------

const sendScheduleDialog = ref(false);
const setSendScheduleDialog = (value: boolean) => {
    sendScheduleDialog.value = value;
}
const scheduleActionDialog = ref(false);
const setScheduleActionDialog = (value: boolean, action: string = '') => {
    scheduleActionDialog.value = value;
    stepThreeFields.value.status = action
}
const getSchedule : any  = computed(() => (getOngoingInspection.value?.schedule));

const stepThreeFields = ref({
    date_time: "",
    comment: "",
    status: "",
});

const stepThreeFieldRules: any = ref({
    date_times: [
        (v: string) => !!v || 'Field is Required',
    ],
})

const proposeTime = async (e: any) => {
    e.preventDefault();

    try {
        setLoading(true)

        const values = { ...stepThreeFields.value }

        const date_times = moment(values?.date_time).format('YYYY-MM-DD hh:mm:ss')

        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "inspection_id": getOngoingInspection.value?.uuid,
            "comment": values?.comment,
            "start_date": date_times,
        }

        const resp = await inspectionStore.proposeTime(objectValues)
            .catch((error: any) => {
                console.log(error)
                throw error
            })
            .then((resp: any) => {
                return resp
            });

        if (resp?.message == 'success') {
            setLoading(false)
            setSendScheduleDialog(false)
            inspectionStore.getOngoingInspection(route.params.inspection_id as string);
        }

        setLoading(false)
        setSendScheduleDialog(false)

        stepThreeFields.value.date_time = "";

    } catch (error) {
        console.log(error)
        setLoading(false)
        setSendScheduleDialog(false)
    }

}
const actionTime = async (e: any) => {
    e.preventDefault();

    try {
        setLoading(true)

        const values = { ...stepThreeFields.value }

        const date_times = values?.date_time ? moment(values?.date_time).format('YYYY-MM-DD hh:mm:ss') : null

        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "inspection_id": getOngoingInspection.value?.uuid,
            "suggested_time": date_times,
            "comment": values?.comment,
            "status": values?.status,
        }

        const resp = await inspectionStore.actionTime(objectValues)
            .catch((error: any) => {
                console.log(error)
                throw error
            })
            .then((resp: any) => {
                return resp
            });

        if (resp?.message == 'success') {
            setLoading(false)
            setScheduleActionDialog(false)
            inspectionStore.getOngoingInspection(route.params.inspection_id as string);
        }

        setLoading(false)
        setScheduleActionDialog(false)
        stepThreeFields.value.date_time = "";



    } catch (error) {
        console.log(error)
        setLoading(false)
        setScheduleActionDialog(false)
    }

}
// const actionAcceptedTime = async (value: any) => {


//     try {


//         let objectValues = {
//             "organization_id": getActiveOrg.value?.uuid,
//             "inspection_id": getOngoingInspection.value?.uuid,
//             "action": value,
//         }

        
//         Swal.fire({
//             title: 'Info!',
//             text: 'Are you sure?',
//             icon: 'info',
//             confirmButtonText: 'Yes',
//             cancelButtonText: 'No',
//             showCancelButton: true,
//             allowOutsideClick: false,
//         }).then((result) => {
//             if (result.isConfirmed) {

                
//                 inspectionStore.actionAcceptedTime(objectValues)
//                     .catch((error: any) => {
//                         throw error
//                     })
//                     .then((resp: any) => {
//                          inspectionStore.getOngoingInspection(route.params.inspection_id as string);
//                         return resp
//                     });


//             }
//         });
        



//     } catch (error) {
//         console.log(error)
//     }

// }


//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------


const questionTab = ref('question-tab-0');
const questionOldTab = ref('');

function changeQuestionTab(e: string) {
    questionTab.value = e;
}
// console.log(questionTab.value)
const getQuestions : any  = computed(() => (getOngoingInspection.value?.questions));

const sendCommentDialog = ref(false);
const setSendCommentDialog = (value: boolean, item_id: string = '', topic_id: string = '', question : { 
    comment : string,  
    response : {
        comment : string
        } 
    }  =  { 
    comment : '',  
    response : {
        comment : ''
        } 
    }) => {
    sendCommentDialog.value = value;
    stepFourFields.value.question_id = item_id
    stepFourFields.value.topic_id = topic_id
    stepFourFields.value.comments = question?.comment ? question?.comment  : (question?.response?.comment ? question?.response?.comment : "")
}

const stepFourFields = ref({
    question_id: "",
    topic_id: "",
    type: "",
    comments: "",
});


const stepFourFieldRules: any = ref({
    response: [
        (v: string) => !!v || 'Field is Required',
    ],
    comments: [
        (v: string) => !!v || 'Field is Required',
    ],
})


const sendQuestionResponse = async (question_id: number, response: string, topic : number) => {
    

    try {

        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "inspection_id": getOngoingInspection.value?.uuid,
            "inspection_question_id": question_id,
            "response": response,
        }

        const resp = await inspectionStore.sendQuestionResponse(objectValues)
            .catch((error: any) => {
                console.log(error)
                throw error
            })
            .then((resp: any) => {
                return resp
            });

        if (resp?.message == 'success') {
            getOngoingInspection.questions.forEach((question: any, index: number) => {
            // inspectionStore.ongoingInspection.questions.forEach((question: any, index: number) => {
                if(question.id == topic) {
                     question.questions.forEach((main_question: any, subIndex: number) => {
                        if(main_question.id == question_id) {
                            // inspectionStore.ongoingInspection.questions[index].questions[subIndex].answer = response
                            getOngoingInspection.questions[index].questions[subIndex].answer = response
                        }
                     })
                }
            })
            
        }


    } catch (error) {
        
    }

}


const sendQuestionComment = async (e: any) => {
    e.preventDefault();

    try {
        setLoading(true)

        const values = { ...stepFourFields.value }


        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "inspection_id": getOngoingInspection.value?.uuid,
            "inspection_question_id": values?.question_id,
            "comment": values?.comments,
        }

        const resp = await inspectionStore.sendQuestionComment(objectValues)
            .catch((error: any) => {
                console.log(error)
                throw error
            })
            .then((resp: any) => {
                return resp
            });

        
        if (resp?.message == 'success') {
            getOngoingInspection.questions.forEach((question: any, index: number) => {
            // inspectionStore.ongoingInspection.questions.forEach((question: any, index: number) => {
                if(question.id == values?.topic_id) {
                     question.questions.forEach((main_question: any, subIndex: number) => {
                        if(main_question.id == values?.question_id) {
                            // inspectionStore.ongoingInspection.questions[index].questions[subIndex].comment = values?.comments
                            getOngoingInspection.questions[index].questions[subIndex].comment = values?.comments
                        }
                     })
                }
            })
            
        }

        setLoading(false)
        setSendCommentDialog(false)

        stepFourFields.value.comments = "";

    } catch (error) {
        console.log(error)
        setLoading(false)
        setSendCommentDialog(false)
    }

}


//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------


const getFindings : any  = computed(() => (getOngoingInspection.value?.findings));
const getActions : any  = computed(() => (getOngoingInspection.value?.actions));


const stepFiveFields = ref({
    title: "",
    description: "",
    assigneeId: "",
    priorityId: "",
    end_date: "",
    start_date: "",
    detail: "",
    organization_id: getActiveOrg.value?.uuid,
    
});

const stepFiveFieldRules : any = ref({
    priorityId: [
        (v: string) => !!v || 'Priority is required',
    ],
    assigneeId: [
        (v: string) => !!v || 'User is required',
    ],
    title: [
        (v: string) => !!v || 'Title  is required',
    ],
    detail: [
        (v: string) => !!v || 'Title  is required',
    ],
    description: [
        (v: string) => !!v || 'Description is required',
        (v: string) => v.length > 10 || 'More than ten letters required'
    ],
    end_date: [
        (v: string) => !!v || 'End Date is required',
        // (v: string) => v.length > 10 || 'More than ten letters required'
    ],
    start_date: [
        (v: string) => !!v || 'Start Date is required',
        // (v: string) => v.length > 10 || 'More than ten letters required'
    ],
})

const sendFindings = async (e: any) => {
    e.preventDefault();

    try {
        setLoading(true)

        const values = { ...stepFiveFields.value }


        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "inspection_id": getOngoingInspection.value?.uuid,
            "detail":  values?.detail,
        }

        const resp = await inspectionStore.sendFindings(objectValues)
            .catch((error: any) => {
                console.log(error)
                throw error
            })
            .then((resp: any) => {
                return resp
            });

        if (resp?.message == 'success') {
            setLoading(false)
            setViewFindingDialog(false)
            inspectionStore.getOngoingInspection(route.params.inspection_id as string);
        }

        setLoading(false)
        setViewFindingDialog(false)
        stepFiveFields.value.detail = ''
    } catch (error) {
        console.log(error)
        setLoading(false)           
         setViewFindingDialog(false)
    }


}
const sendRecommendation = async (e: any) => {
    e.preventDefault();

    try {
        setLoading(true)

        const values = { ...stepFiveFields.value }

        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "inspection_id": getOngoingInspection.value?.uuid,
            "title": values?.title,
            "description": values?.description,
            "assignee_id": values?.assigneeId,
            "start_date": moment(values?.start_date).format('YYYY-MM-DD HH:mm:ss'),
            "end_date":  moment(values?.end_date).format('YYYY-MM-DD HH:mm:ss'),  
            "priority_id": values?.priorityId
        }


        const resp = await inspectionStore.sendRecommendation(objectValues)
            .catch((error: any) => {
                console.log(error)
                throw error
            })
            .then((resp: any) => {
                return resp
            });


        if (resp?.message == 'success') {
            setLoading(false)
            setViewRecommendationDialog(false)
            inspectionStore.getOngoingInspection(route.params.inspection_id as string);
        }

        setLoading(false)
        setViewRecommendationDialog(false)



    } catch (error) {
        console.log(error)
        setLoading(false)
        setViewRecommendationDialog(false)
    }

}


const completeInspection = async (member: any) => {

    try {
        setLoading(true)
        
        let objectValues = {
            "organization_id": getActiveOrg.value?.uuid,
            "inspection_id": getOngoingInspection.value?.uuid,
        }
        
        Swal.fire({
            title: 'Info!',
            text: 'Do you want to close inspection?',
            icon: 'info',
            confirmButtonText: 'Yes',
            cancelButtonText: 'No',
            showCancelButton: true,
            allowOutsideClick: false,
        }).then((result) => {
            if (result.isConfirmed) {
                
                
                inspectionStore.completeInspection(objectValues)
                    .catch((error: any) => {
                        throw error
                    })
                    .then((resp: any) => {
                        //  investigationStore.getInvestigation(route.params.observation_id as string);
                        // 
                        if(resp.message == 'success') {
                            router.push(`/inspections`)
                        }
                        // return resp
                    });


            }
        });

        
            


        setLoading(false)

    } catch (error) {
        console.log(error)
        setLoading(false)
    }

}


//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------------------------------------------

// ---------------------------------------------------

const thankyou = ref(false);

const tab = ref('tab-1');
const checkbox = ref([]);

function changeTab(e: string) {
    tab.value = e;
}
const blankFn = () => {
    console.log('black')
}



</script>

<template>
    <div>
        <BaseBreadcrumb :title="page.title" :breadcrumbs="breadcrumbs"></BaseBreadcrumb>


        <v-row v-if="getOngoingInspection?.is_accepted || getOngoingInspection?.is_ongoing ">
            <v-col cols="12" md="11">

                <UiParentCard variant="outlined">
                    <v-card-text>
                        <h1 class="text-uppercase mb-3"> Inspection Facility - {{ getOngoingInspection?.facility_name }}
                        </h1>
                        <h2 class="text-uppercase mb-3">Organization - {{
                            getOngoingInspection?.recipient_organization?.name }}</h2>
                    </v-card-text>
                    <v-card-text>
                        <v-tabs v-model="tab" color="primary" class="customTab">
                            <v-tab value="tab-1" rounded="md" class="mb-3 mx-2 text-left" height="70">
                                <UsersIcon stroke-width="1.5" width="20" class="v-icon--start" />
                                <div>
                                    <div>Build Team</div>
                                    <span
                                        class="text-subtitle-2 text-lightText text-medium-emphasis font-weight-medium d-block">Members</span>
                                </div>
                            </v-tab>

                            <v-tab value="tab-2" rounded="md" class="mb-3 mx-2 text-left" height="70">
                                <UsersIcon stroke-width="1.5" width="20" class="v-icon--start" />
                                <div>
                                    <div>Basic Inspection</div>
                                    <span
                                        class="text-subtitle-2 text-lightText text-medium-emphasis font-weight-medium d-block">Details</span>
                                </div>
                            </v-tab>


                            <v-tab value="tab-3" rounded="md" class="mb-3 mx-2 text-left" height="70">
                                <CreditCardIcon stroke-width="1.5" width="20" class="v-icon--start" />
                                <div>
                                    <div>Send Schedule</div>
                                    <span
                                        class="text-subtitle-2 text-lightText text-medium-emphasis font-weight-medium d-block">
                                        To Organization
                                    </span>
                                </div>
                            </v-tab>
                            <v-tab value="tab-4" rounded="md" class="mb-3 mx-2 text-left" height="70">
                                <CreditCardIcon stroke-width="1.5" width="20" class="v-icon--start" />
                                <div>
                                    <div>Onsite Inspection</div>
                                    <span
                                        class="text-subtitle-2 text-lightText text-medium-emphasis font-weight-medium d-block">
                                        Start
                                    </span>
                                </div>
                            </v-tab>
                            <v-tab value="tab-5" rounded="md" class="mb-3 mx-2 text-left" height="70">
                                <CreditCardIcon stroke-width="1.5" width="20" class="v-icon--start" />
                                <div>
                                    <div>Inspection Findings </div>
                                    <span
                                        class="text-subtitle-2 text-lightText text-medium-emphasis font-weight-medium d-block">
                                        And Action
                                    </span>
                                </div>
                            </v-tab>
                        </v-tabs>
                        <v-window v-model="tab" class="customTab">
                            <v-window-item value="tab-1" class="pa-1">

                                <div>
                                    <v-row class="mt-3 px-4">

                                        <v-col cols="12">

                                            <v-btn color="primary" @click="setAddInspectorsDialog(true)" class="mr-2"
                                                v-if="isInspectingOrg">Add Inspector</v-btn>
                                            <v-btn color="primary" @click="setAddRepresentativeDialog(true)"
                                                class="mr-2" v-if="isInspecteeOrg">Add Representatives</v-btn>
                                            <v-sheet>
                                                <v-dialog v-model="addInspectorsDialog" max-width="800">
                                                    <v-card>


                                                        <v-card-text>

                                                            <div class="d-flex justify-space-between">
                                                                <h3 class="text-h3">Add Inspectors </h3>
                                                                <v-btn icon @click="setAddInspectorsDialog(false)"
                                                                    size="small" flat>
                                                                    <XIcon size="16" />
                                                                </v-btn>
                                                            </div>

                                                        </v-card-text>
                                                        <v-divider></v-divider>

                                                        <v-card-text>

                                                            <VForm v-model="valid" ref="formContainer" fast-fail
                                                                lazy-validation @submit.prevent="sendInspectors"
                                                                class="py-1">
                                                                <VRow class="mt-5 mb-3">

                                                                    <VCol cols="12" md="12">
                                                                        <v-label class="font-weight-medium pb-1">Select
                                                                            Lead Inspector</v-label>
                                                                        <VSelect v-model="fields.leadInspector"
                                                                            :items="getInspectingMembers"
                                                                            @update:modelValue="fields.inspectorMembers = []"
                                                                            :rules="fieldRules.leadInspector"
                                                                            label="Select" item-title="lastName"
                                                                            item-value="id"
                                                                            :item-props="(item: any) => ({ title: `${item?.lastName} ${item?.firstName}`, subtitle: `${item?.email}` })"
                                                                            single-line variant="outlined"
                                                                            class="text-capitalize">
                                                                        </VSelect>
                                                                    </VCol>

                                                                    <VCol cols="12" md="12">
                                                                        <v-label class="font-weight-medium pb-1">Select
                                                                            Team Members</v-label>
                                                                        <VSelect v-model="fields.inspectorMembers"
                                                                            :items="filteredLeadInspector"
                                                                            label="Select" item-title="lastName"
                                                                            item-value="id"
                                                                            :item-props="(item: any) => ({ title: `${item?.lastName} ${item?.firstName}`, subtitle: `${item?.email}` })"
                                                                            single-line variant="outlined"
                                                                            class="text-capitalize" multiple chips>
                                                                        </VSelect>
                                                                    </VCol>



                                                                    <VCol cols="12" lg="12" class="text-right">
                                                                        <v-btn color="error"
                                                                            @click="setAddInspectorsDialog(false)"
                                                                            variant="text">Cancel</v-btn>

                                                                        <v-btn color="primary" type="submit"
                                                                            :loading="loading" :disabled="!valid"
                                                                            @click="sendInspectors">
                                                                            <span v-if="!loading">
                                                                                Save
                                                                            </span>
                                                                            <clip-loader v-else :loading="loading"
                                                                                color="white"
                                                                                :size="'25px'"></clip-loader>
                                                                        </v-btn>

                                                                    </VCol>
                                                                </VRow>
                                                            </VForm>
                                                        </v-card-text>
                                                    </v-card>
                                                </v-dialog>

                                                <v-dialog v-model="addRepresentativeDialog" max-width="800">
                                                    <v-card>

                                                        <v-card-text>
                                                            <div class="d-flex justify-space-between">
                                                                <h3 class="text-h3">Add Representative </h3>
                                                                <v-btn icon @click="setAddRepresentativeDialog(false)"
                                                                    size="small" flat>
                                                                    <XIcon size="16" />
                                                                </v-btn>
                                                            </div>
                                                        </v-card-text>
                                                        <v-divider></v-divider>

                                                        <v-card-text>

                                                            <VForm v-model="valid" ref="formContainer" fast-fail
                                                                lazy-validation @submit.prevent="sendRepresentatives"
                                                                class="py-1">
                                                                <VRow class="mt-5 mb-3">

                                                                    <VCol cols="12" md="12">
                                                                        <v-label class="font-weight-medium pb-1">Select
                                                                            a lead
                                                                            Representative</v-label>
                                                                        <VSelect v-model="fields.leadRepresentative"
                                                                            :items="getInspecteeMembers"
                                                                            update:modelValue="fields.representatives = []"
                                                                            :rules="fieldRules.leadRepresentative"
                                                                            label="Select" item-title="lastName"
                                                                            item-value="id"
                                                                            :item-props="(item: any) => ({ title: `${item?.lastName} ${item?.firstName}`, subtitle: `${item?.email}` })"
                                                                            single-line variant="outlined"
                                                                            class="text-capitalize">
                                                                        </VSelect>
                                                                    </VCol>

                                                                    <VCol cols="12" md="12"
                                                                        v-if="fields.leadRepresentative">
                                                                        <v-label class="font-weight-medium pb-1">Select
                                                                            Representatives</v-label>
                                                                        <VSelect v-model="fields.representatives"
                                                                            :items="filteredgetInspecteeMembers"
                                                                            :rules="fieldRules.representatives"
                                                                            label="Select" item-title="lastName"
                                                                            item-value="id" single-line
                                                                            variant="outlined" class="text-capitalize"
                                                                            chips
                                                                            :item-props="(item: any) => ({ title: `${item?.lastName} ${item?.firstName}`, subtitle: `${item?.email}` })"
                                                                            multiple>

                                                                        </VSelect>
                                                                    </VCol>



                                                                    <VCol cols="12" lg="12" class="text-right">
                                                                        <v-btn color="error"
                                                                            @click="setAddRepresentativeDialog(false)"
                                                                            variant="text">Cancel</v-btn>

                                                                        <v-btn color="primary" type="submit"
                                                                            :loading="loading" :disabled="!valid"
                                                                            @click="sendRepresentatives">
                                                                            <span v-if="!loading">
                                                                                Save
                                                                            </span>
                                                                            <clip-loader v-else :loading="loading"
                                                                                color="white"
                                                                                :size="'25px'"></clip-loader>
                                                                        </v-btn>

                                                                    </VCol>
                                                                </VRow>
                                                            </VForm>
                                                        </v-card-text>
                                                    </v-card>
                                                </v-dialog>
                                            </v-sheet>
                                        </v-col>

                                        <v-col cols="12">
                                            <v-table>
                                                <thead>
                                                    <tr>
                                                        <th class="text-left">
                                                            #
                                                        </th>
                                                        <th class="text-left">
                                                            Full Name
                                                        </th>
                                                        <th class="text-left">
                                                            Email
                                                        </th>
                                                        <th class="text-left">
                                                            Position
                                                        </th>
                                                        <th class="text-left">
                                                            Action
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>

                                                    <template v-if="isInspectingOrg">
                                                        <tr v-for="(member, index) in getInspectors" :key="member">
                                                            <td>{{ computedIndex(index) }}</td>
                                                            <td>{{ `${member?.member?.lastName}
                                                                ${member?.member?.firstName}` }}</td>
                                                            <td>{{ `${member?.member?.email}` }}</td>
                                                            <td>{{ `${member?.position.split('_').join(' ')}` }}</td>
                                                            <td>
                                                                <v-btn color='error' size='small'
                                                                    @click="removeMember(member?.member?.id)">
                                                                    Remove
                                                                </v-btn>
                                                            </td>
                                                        </tr>
                                                    </template>
                                                    <template v-if="isInspecteeOrg">
                                                        <tr v-for="(member, index) in getRepresentatives" :key="member">
                                                            <td>{{ computedIndex(index) }}</td>
                                                            <td>{{ `${member?.member?.lastName}
                                                                ${member?.member?.firstName}` }}</td>
                                                            <td>{{ `${member?.member?.email}` }}</td>
                                                            <td>{{ `${member?.position.split('_').join(' ')}` }}</td>
                                                            <td>
                                                                <v-btn color='error' size='small'
                                                                    @click="removeMember(member?.member?.id)">
                                                                    Remove
                                                                </v-btn>
                                                            </td>
                                                        </tr>
                                                    </template>

                                                </tbody>
                                            </v-table>
                                        </v-col>
                                    </v-row>

                                </div>


                                <v-row class="mt-3">
                                    <v-col cols="12" sm="6">

                                    </v-col>
                                    <v-col cols="12" sm="6" class="text-sm-right">
                                        <v-btn color="primary" @click="changeTab('tab-2')"
                                            v-if="isLoggedInUserIsleadInspector || isLoggedInUserIsLeadRepresentative">Next
                                            Step</v-btn>
                                    </v-col>
                                </v-row>
                            </v-window-item>
                            <v-window-item value="tab-2" class="pa-1">

                                <div>
                                    <v-row class="mt-3 px-4">

                                        <v-col cols="12">

                                            <v-btn color="primary" @click="setUpdateInspectionDialog(true)" class="mr-2"
                                                v-if="isSameOrg || isLoggedInUserIsLeadRepresentative">Update
                                                Detail</v-btn>
                                            <!-- <v-btn color='primary' @click="proceedInspection"
                                                v-if="isSameOrg || isLoggedInUserIsLeadRepresentative">
                                                Proceed
                                            </v-btn> -->
                                            <v-btn color='primary' @click="proceedInspection">
                                                Proceed
                                            </v-btn>
                                            <v-sheet>
                                                <v-dialog v-model="updateInspectionDialog" max-width="800">
                                                    <v-card>


                                                        <v-card-text>

                                                            <div class="d-flex justify-space-between">
                                                                <h3 class="text-h3">Update Inspection Details</h3>
                                                                <v-btn icon @click="setUpdateInspectionDialog(false)"
                                                                    size="small" flat>
                                                                    <XIcon size="16" />
                                                                </v-btn>
                                                            </div>

                                                        </v-card-text>
                                                        <v-divider></v-divider>

                                                        <v-card-text>

                                                            <VForm v-model="valid" ref="formContainer" fast-fail
                                                                lazy-validation
                                                                @submit.prevent="updateInspectionDetails" class="py-1">
                                                                <VRow class="mt-5 mb-3">

                                                                    <VCol cols="12" md="12">
                                                                        <v-label
                                                                            class="text-subtitle-1 font-weight-medium pb-1">Name
                                                                            Of
                                                                            Facility</v-label>
                                                                        <VTextField type="text"
                                                                            v-model="stepDetailFields.name"
                                                                            :rules="stepDetailFieldRules.name" required
                                                                            variant="outlined" label=""
                                                                            :color="stepDetailFields.name.length > 2 ? 'success' : 'primary'">
                                                                        </VTextField>
                                                                    </VCol>
                                                                    <VCol cols="12" md="12">
                                                                        <v-label
                                                                            class="text-subtitle-1 font-weight-medium pb-1">Location
                                                                            Of
                                                                            Facility</v-label>
                                                                        <VTextField type="text"
                                                                            v-model="stepDetailFields.location"
                                                                            :rules="stepDetailFieldRules.location"
                                                                            required variant="outlined" label=""
                                                                            :color="stepDetailFields.location.length > 2 ? 'success' : 'primary'">
                                                                        </VTextField>
                                                                    </VCol>


                                                                    <VCol cols="12" md="12">
                                                                        <v-label
                                                                            class="text-subtitle-1 font-weight-medium pb-1">Description
                                                                            Of
                                                                            Facility</v-label>
                                                                        <VTextarea type="text"
                                                                            v-model="stepDetailFields.description"
                                                                            :rules="stepDetailFieldRules.description"
                                                                            required variant="outlined" label=""
                                                                            :color="stepDetailFields.description.length > 2 ? 'success' : 'primary'">
                                                                        </VTextarea>
                                                                    </VCol>


                                                                    <VCol cols="12" md="12">
                                                                        <v-label
                                                                            class="text-subtitle-1 font-weight-medium pb-1">Objective
                                                                            Of
                                                                            Inspection</v-label>
                                                                        <VTextarea type="text"
                                                                            v-model="stepDetailFields.objective"
                                                                            :rules="stepDetailFieldRules.objective"
                                                                            required variant="outlined" label=""
                                                                            :color="stepDetailFields.objective.length > 2 ? 'success' : 'primary'">
                                                                        </VTextarea>
                                                                    </VCol>

                                                                    <VCol cols="12" md="12">
                                                                        <v-label
                                                                            class="text-subtitle-1 font-weight-medium pb-1">Personal
                                                                            Protective
                                                                            Equipment (PPE) </v-label>
                                                                        <VTextarea type="text"
                                                                            v-model="stepDetailFields.ppe"
                                                                            :rules="stepDetailFieldRules.ppe" required
                                                                            variant="outlined" label=""
                                                                            :color="stepDetailFields.ppe.length > 2 ? 'success' : 'primary'">
                                                                        </VTextarea>
                                                                    </VCol>


                                                                    <VCol cols="12" lg="12" class="text-right">
                                                                        <v-btn color="error"
                                                                            @click="setUpdateInspectionDialog(false)"
                                                                            variant="text">Cancel</v-btn>

                                                                        <v-btn color="primary" type="submit"
                                                                            :loading="loading" :disabled="!valid"
                                                                            @click="updateInspectionDetails">
                                                                            <span v-if="!loading">
                                                                                Save
                                                                            </span>
                                                                            <clip-loader v-else :loading="loading"
                                                                                color="white"
                                                                                :size="'25px'"></clip-loader>
                                                                        </v-btn>

                                                                    </VCol>
                                                                </VRow>
                                                            </VForm>
                                                        </v-card-text>
                                                    </v-card>
                                                </v-dialog>
                                            </v-sheet>
                                        </v-col>

                                        <v-col cols="12">
                                            <v-table>
                                                <thead>
                                                    <tr>
                                                        <th class="text-left">
                                                            #
                                                        </th>
                                                        <th class="text-left">
                                                            Facility Name
                                                        </th>
                                                        <th class="text-left">
                                                            Location
                                                        </th>
                                                        <th class="text-left">
                                                            Description
                                                        </th>
                                                        <th class="text-left">
                                                            Objective
                                                        </th>
                                                        <th class="text-left">
                                                            PPE
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>

                                                    <template v-if="getOngoingInspection">
                                                        <tr>
                                                            <td></td>

                                                            <td>{{ `${getOngoingInspection?.facility_name}` }}</td>
                                                            <td>{{ `${getOngoingInspection?.location}` }}</td>
                                                            <td>{{ `${getOngoingInspection?.description}` }}</td>
                                                            <td>{{ `${getOngoingInspection?.objective}` }}</td>
                                                            <td>{{ `${getOngoingInspection?.ppe}` }}</td>
                                                        </tr>
                                                    </template>

                                                </tbody>
                                            </v-table>
                                        </v-col>
                                    </v-row>

                                </div>
                                <v-row class="mt-3">
                                    <v-col cols="12" sm="6">

                                    </v-col>
                                    <v-col cols="12" sm="6" class="text-sm-right">
                                        <v-btn color="primary" @click="changeTab('tab-2')"
                                            v-if="isLoggedInUserIsleadInspector || isLoggedInUserIsLeadRepresentative">Next
                                            Step</v-btn>
                                    </v-col>
                                </v-row>
                            </v-window-item>
                            <v-window-item value="tab-3" class="pa-1">

                                <div>
                                    <v-row class="mt-3 px-4">
                                        <v-col cols="12">
                                            
                                                            <template v-if="!getSchedule?.is_sent">
                                            <v-btn color="primary" @click="setSendScheduleDialog(true)" class="mr-2"
                                                v-if="isLoggedInUserIsleadInspector && !getSchedule?.is_accepted">Send
                                                Onsite Schedule</v-btn>
                                                            </template>
                                            <v-btn color="primary" @click="console.log('start onsite')" class="mr-2"
                                                v-if="isLoggedInUserIsleadInspector && getSchedule?.is_accepted">Start
                                                Onsite</v-btn>
                                            <v-sheet>
                                                <v-dialog v-model="scheduleActionDialog" max-width="800">
                                                    <v-card>


                                                        <v-card-text>
                                                            <div class="d-flex justify-space-between">
                                                                <h3 class="text-h3">Action Schedule </h3>
                                                                <v-btn icon @click="setScheduleActionDialog(false)"
                                                                    size="small" flat>
                                                                    <XIcon size="16" />
                                                                </v-btn>
                                                            </div>
                                                        </v-card-text>
                                                        <v-divider></v-divider>

                                                        <v-card-text>
                                                            <VForm v-model="valid" ref="formContainer" fast-fail
                                                                lazy-validation @submit.prevent="actionTime"
                                                                class="py-1">
                                                                <VRow class="mt-5 mb-3">

                                                                    <VCol cols="12" md="12">
                                                                        <v-label
                                                                            class="font-weight-medium pb-1">Action</v-label>
                                                                        <VSelect v-model="stepThreeFields.status"
                                                                            :items="[{ 'name': 'accepted', 'description': 'Accept Schedule' }, { 'name': 'declined', 'description': 'Decline Schedule' }]"
                                                                            label="Select" single-line
                                                                            variant="outlined" class="text-capitalize"
                                                                            :rules="[(v: any) => !!v || 'You must select to continue!']"
                                                                            item-title='description' item-value="name"
                                                                            required>
                                                                        </VSelect>
                                                                    </VCol>
                                                                    <template
                                                                        v-if="stepThreeFields.status == 'declined'">
                                                                        <VCol cols="12" md="12">
                                                                            <v-label
                                                                                class="font-weight-medium pb-1">Suggest
                                                                                Time</v-label>
                                                                            <VueDatePicker
                                                                                input-class-name="dp-custom-input"
                                                                                v-model="stepThreeFields.date_time"
                                                                                :min-date="new Date()" required>
                                                                            </VueDatePicker>
                                                                        </VCol>

                                                                        <VCol cols="12" md="12">
                                                                            <v-label
                                                                                class="text-subtitle-1 font-weight-medium pb-1">Comment</v-label>
                                                                            <VTextarea variant="outlined" outlined
                                                                                name="Comment" label="Comment"
                                                                                v-model="stepThreeFields.comment"
                                                                                required
                                                                                :color="stepThreeFields.comment.length > 10 ? 'success' : 'primary'">
                                                                            </VTextarea>
                                                                        </VCol>


                                                                    </template>



                                                                    <VCol cols="12" lg="12" class="text-right">

                                                                        <v-btn color="error"
                                                                            @click="setScheduleActionDialog(false)"
                                                                            variant="text">Cancel</v-btn>

                                                                        <v-btn color="primary" type="submit"
                                                                            :loading="loading" :disabled="!valid"
                                                                            @click="actionTime">
                                                                            <span v-if="!loading">
                                                                                Send Response
                                                                            </span>
                                                                            <clip-loader v-else :loading="loading"
                                                                                color="white"
                                                                                :size="'25px'"></clip-loader>
                                                                        </v-btn>

                                                                    </VCol>
                                                                </VRow>
                                                            </VForm>

                                                        </v-card-text>
                                                    </v-card>
                                                </v-dialog>
                                                <v-dialog v-model="sendScheduleDialog" max-width="800">
                                                    <v-card min-height="800">

                                                        <v-card-text>
                                                            <div class="d-flex justify-space-between">
                                                                <h3 class="text-h3">Add Schedule </h3>
                                                                <v-btn icon @click="setSendScheduleDialog(false)"
                                                                    size="small" flat>
                                                                    <XIcon size="16" />
                                                                </v-btn>
                                                            </div>
                                                        </v-card-text>
                                                        <v-divider></v-divider>

                                                        <v-card-text>
                                                            <VForm v-model="valid" ref="formContainer" fast-fail
                                                                lazy-validation @submit.prevent="proposeTime"
                                                                class="py-1">
                                                                <VRow class="mt-5 mb-3">

                                                                    <VCol cols="12" md="12">
                                                                        <v-label class="font-weight-medium pb-1">Select
                                                                            Dates</v-label>
                                                                        <VueDatePicker
                                                                            input-class-name="dp-custom-input"
                                                                            v-model="stepThreeFields.date_time"
                                                                            :min-date="new Date()" required>
                                                                        </VueDatePicker>
                                                                    </VCol>



                                                                    <VCol cols="12" lg="12" class="text-right">

                                                                        <v-btn color="error"
                                                                            @click="setSendScheduleDialog(false)"
                                                                            variant="text">Cancel</v-btn>

                                                                        <v-btn color="primary" type="submit"
                                                                            :loading="loading" :disabled="!valid"
                                                                            @click="proposeTime">
                                                                            <span v-if="!loading">
                                                                                Send Schedule
                                                                            </span>
                                                                            <clip-loader v-else :loading="loading"
                                                                                color="white"
                                                                                :size="'25px'"></clip-loader>
                                                                        </v-btn>

                                                                    </VCol>
                                                                </VRow>
                                                            </VForm>

                                                        </v-card-text>
                                                    </v-card>
                                                </v-dialog>
                                            </v-sheet>
                                        </v-col>

                                        <v-col cols="12">
                                            <v-table>
                                                <thead>
                                                    <tr>

                                                        <th class="text-left">
                                                            #
                                                        </th>
                                                        <th class="text-left">
                                                            Proposed Time
                                                        </th>
                                                        <th class="text-left">
                                                            Suggested TIme
                                                        </th>
                                                        <th class="text-left">
                                                            Agreed Time
                                                        </th>
                                                        <th class="text-left">
                                                            Comment
                                                        </th>
                                                        <th class="text-left">
                                                            Action
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>{{ ''}}</td>
                                                        <td>
                                                            {{ `${getSchedule?.propose_time ? getSchedule?.propose_time
                                                            : ""}` }}

                                                        </td>
                                                        <td>
                                                            {{ `${getSchedule?.suggested_time ?
                                                            getSchedule?.suggested_time : ""}` }}

                                                        </td>
                                                        <td>
                                                            {{ `${getSchedule?.accepted_time ?
                                                            getSchedule?.accepted_time : ""}` }}
                                                        </td>
                                                        <td>
                                                            {{ `${getSchedule?.comment ?
                                                            getSchedule?.comment : ""}` }}
                                                        </td>
                                                        <td>
                                                            <template v-if="getSchedule?.is_sent">
                                                                <v-btn color='primary' size='small' class="mr-2"
                                                                    @click="setScheduleActionDialog(true, 'accepted')"
                                                                    v-if="isLoggedInUserIsLeadRepresentative && !getSchedule?.is_accepted && getSchedule?.propose_time ">
                                                                    Accept
                                                                </v-btn>
                                                                <v-btn color='error' size='small' class="mr-2"
                                                                    @click="setScheduleActionDialog(true, 'declined')"
                                                                    v-if="isLoggedInUserIsLeadRepresentative && !getSchedule?.is_accepted && getSchedule?.propose_time ">
                                                                    Decline
                                                                </v-btn>
                                                            </template>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </v-table>
                                        </v-col>
                                    </v-row>

                                </div>
                                <v-row class="mt-3">
                                    <v-col cols="6">
                                        <v-btn color="primary" variant="tonal" @click="changeTab('tab-2')">Back</v-btn>
                                    </v-col>
                                    <v-col cols="6" class="text-right">
                                        <v-btn color="primary" @click="changeTab('tab-4')"
                                            v-if="isLoggedInUserIsleadInspector || isLoggedInUserIsLeadRepresentative">Next
                                            Step</v-btn>
                                    </v-col>
                                </v-row>
                            </v-window-item>
                            <v-window-item value="tab-4" class="pa-1">

                                <div>
                                    <v-row class="mt-3 px-4">


                                        <v-col cols="12">

                                            <v-window v-model="questionTab" class="customTab">
                                                <template v-if="getQuestions.length > 0">
                                                    <v-window-item v-for="(title_question, index) in getQuestions"
                                                        :key="title_question" :value="`questionTab-${index}`"
                                                        class="pa-1">

                                                        <div>
                                                            <v-row class="mt-3 px-4">

                                                                <v-col cols="12">


                                                                    <v-sheet>
                                                                        <v-dialog v-model="sendCommentDialog"
                                                                            max-width="800">
                                                                            <v-card>


                                                                                <v-card-text>
                                                                                    <div class="d-flex justify-space-between"
                                                                                        v-if="isLoggedInUserIsleadInspector">
                                                                                        <h3 class="text-h3">Send Comment
                                                                                        </h3>
                                                                                        <v-btn icon
                                                                                            @click="setSendCommentDialog(false)"
                                                                                            size="small" flat>
                                                                                            <XIcon size="16" />
                                                                                        </v-btn>
                                                                                    </div>
                                                                                </v-card-text>
                                                                                <v-divider></v-divider>

                                                                                <v-card-text>

                                                                                    <VForm v-model="valid"
                                                                                        ref="formContainer" fast-fail
                                                                                        lazy-validation
                                                                                        @submit.prevent="sendQuestionComment"
                                                                                        class="py-1">
                                                                                        <VRow class="mt-5 mb-3">

                                                                                            <VCol cols="12" md="12">
                                                                                                <v-label
                                                                                                    class="text-subtitle-1 font-weight-medium pb-1">Comments</v-label>
                                                                                                <VTextarea
                                                                                                    variant="outlined"
                                                                                                    outlined
                                                                                                    name="Comment"
                                                                                                    :readonly="!isLoggedInUserIsleadInspector"
                                                                                                    label="Comment"
                                                                                                    v-model="stepFourFields.comments"
                                                                                                    :rules="stepFourFieldRules.comments"
                                                                                                    required
                                                                                                    :color="stepFourFields.comments.length > 10 ? 'success' : 'primary'">
                                                                                                </VTextarea>
                                                                                            </VCol>



                                                                                            <VCol cols="12" lg="12"
                                                                                                class="text-right">
                                                                                                <v-btn color="error"
                                                                                                    @click="setSendCommentDialog(false)"
                                                                                                    variant="text">Close</v-btn>

                                                                                                <v-btn color="primary"
                                                                                                    type="submit"
                                                                                                    :loading="loading"
                                                                                                    :disabled="!valid"
                                                                                                    @click="sendQuestionComment"
                                                                                                    v-if="isLoggedInUserIsleadInspector">
                                                                                                    <span
                                                                                                        v-if="!loading">
                                                                                                        Send
                                                                                                    </span>
                                                                                                    <clip-loader v-else
                                                                                                        :loading="loading"
                                                                                                        color="white"
                                                                                                        :size="'25px'"></clip-loader>
                                                                                                </v-btn>

                                                                                            </VCol>
                                                                                        </VRow>
                                                                                    </VForm>
                                                                                </v-card-text>
                                                                            </v-card>
                                                                        </v-dialog>
                                                                    </v-sheet>
                                                                </v-col>

                                                                <v-col cols="12">
                                                                    <h2>{{title_question.title}}</h2>
                                                                    <v-table>
                                                                        <thead>
                                                                            <tr>
                                                                                <th class="text-left">
                                                                                    Questions
                                                                                </th>
                                                                                <th class="text-left" width="10%">
                                                                                    Yes
                                                                                </th>
                                                                                <th class="text-left" width="10%">
                                                                                    NC Minor
                                                                                </th>
                                                                                <th class="text-left" width="10%">
                                                                                    NC Major
                                                                                </th>
                                                                                <th class="text-left" width="10%">
                                                                                    NA
                                                                                </th>
                                                                                <th class="text-left">
                                                                                    Comments /  Evidence
                                                                                </th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <!-- {{ title_question.questions }} -->
                                                                            <!-- <template> -->
                                                                            <tr v-for="(question) in title_question.questions"
                                                                                :key="question">
                                                                                <!-- <td>{{ computedIndex(index) }}</td> -->
                                                                                <td>{{ `${question?.question}` }}</td>
                                                                                <td>
                                                                                    <!-- isInspectingOrg -->
                                                                                    <!-- isInspecteeOrg -->
                                                                                    <template
                                                                                        v-if="question?.answer ? question?.answer == 'yes' : question?.response?.answer == 'yes'">
                                                                                        <v-btn color='success'
                                                                                            size='small' flat>
                                                                                            selected
                                                                                        </v-btn>
                                                                                    </template>
                                                                                    <template v-else>
                                                                                        <v-btn color='primary'
                                                                                            size='small' flat
                                                                                            @click="sendQuestionResponse(question?.id, 'yes', title_question.id)"
                                                                                            v-if="isLoggedInUserIsleadInspector">
                                                                                            select
                                                                                        </v-btn>
                                                                                    </template>
                                                                                </td>
                                                                                <td>
                                                                                    <template
                                                                                        v-if="question?.answer ? question?.answer == 'nc_minor' : question?.response?.answer == 'nc_minor'">
                                                                                        <v-btn color='success'
                                                                                            size='small' flat>
                                                                                            selected
                                                                                        </v-btn>
                                                                                    </template>
                                                                                    <template v-else>
                                                                                        <v-btn color='primary'
                                                                                            size='small' flat
                                                                                            @click="sendQuestionResponse(question?.id, 'nc_minor', title_question.id)"
                                                                                            v-if="isLoggedInUserIsleadInspector">
                                                                                            select
                                                                                        </v-btn>
                                                                                    </template>

                                                                                </td>
                                                                                <td>
                                                                                    <template
                                                                                        v-if="question?.answer ? question?.answer == 'nc_major' : question?.response?.answer == 'nc_major'">
                                                                                        <v-btn color='success'
                                                                                            size='small' flat>
                                                                                            selected
                                                                                        </v-btn>
                                                                                    </template>
                                                                                    <template v-else>
                                                                                        <v-btn color='primary'
                                                                                            size='small' flat
                                                                                            @click="sendQuestionResponse(question?.id, 'nc_major', title_question.id)"
                                                                                            v-if="isLoggedInUserIsleadInspector">
                                                                                            select
                                                                                        </v-btn>
                                                                                    </template>

                                                                                </td>
                                                                                <td>
                                                                                    <template
                                                                                        v-if="question?.answer ? question?.answer == 'na' : question?.response?.answer == 'na'">
                                                                                        <v-btn color='success'
                                                                                            size='small' flat>
                                                                                            selected
                                                                                        </v-btn>
                                                                                    </template>
                                                                                    <template v-else>
                                                                                        <v-btn color='primary'
                                                                                            size='small' flat
                                                                                            @click="sendQuestionResponse(question?.id, 'na', title_question.id)"
                                                                                            v-if="isLoggedInUserIsleadInspector">
                                                                                            select
                                                                                        </v-btn>
                                                                                    </template>
                                                                                </td>
                                                                                <td>
                                                                                    <template
                                                                                        v-if="isLoggedInUserIsleadInspector">
                                                                                        <v-btn color='primary'
                                                                                            size='small'
                                                                                            @click="setSendCommentDialog(true, question?.id, title_question.id, question)"
                                                                                            flat>
                                                                                            {{ question?.comment ||
                                                                                            question?.response?.comment
                                                                                            ? 'Edit Comment' :
                                                                                            'Add Comment' }}
                                                                                        </v-btn>
                                                                                    </template>
                                                                                    <template v-else>
                                                                                        <v-btn color='primary'
                                                                                            size='small'
                                                                                            @click="setSendCommentDialog(true, question?.id, title_question.id, question)"
                                                                                            flat
                                                                                            v-if="question?.response?.comment">
                                                                                            {{ "View Comment" }}
                                                                                        </v-btn>
                                                                                    </template>
                                                                                </td>
                                                                            </tr>
                                                                            <!-- </template> -->


                                                                        </tbody>
                                                                    </v-table>
                                                                </v-col>

                                                            </v-row>

                                                        </div>

                                                        <v-row class="mt-3">
                                                            <v-col cols="12" sm="6">
                                                                <v-btn color="primary" variant="tonal"
                                                                    @click="changeQuestionTab(`questionTab-${index-1}`)"
                                                                    v-if="index > 0">Previous Questions</v-btn>
                                                            </v-col>
                                                            <v-col cols="12" sm="6" class="text-sm-right">
                                                                <v-btn color="primary"
                                                                    @click="changeQuestionTab(`questionTab-${index+1}`)"
                                                                    v-if="index < (getQuestions.length - 1)">Next
                                                                    Questions</v-btn>
                                                            </v-col>
                                                        </v-row>
                                                    </v-window-item>
                                                </template>

                                            </v-window>

                                        </v-col>
                                    </v-row>

                                </div>
                                <v-row class="mt-3">
                                    <v-col cols="6">
                                        <v-btn color="primary" variant="tonal" @click="changeTab('tab-3')">Back</v-btn>
                                    </v-col>
                                    <v-col cols="6" class="text-right">
                                        <v-btn color="primary" @click="changeTab('tab-5')"
                                            v-if="isLoggedInUserIsleadInspector || isLoggedInUserIsLeadRepresentative">Next
                                            Step</v-btn>
                                    </v-col>
                                </v-row>
                            </v-window-item>
                            <v-window-item value="tab-5" class="pa-1">
                                <div>
                                    <v-row class="mt-3 px-4">


                                        <v-col cols="12">
                                            <v-btn color="primary" @click="setViewFindingDialog(true)" class="mr-2">Add
                                                Finding</v-btn>

                                            <v-sheet>
                                                <v-dialog v-model="viewFindingDialog" max-width="700">
                                                    <v-card>

                                                        <v-card-text>
                                                            <div class="d-flex justify-space-between">
                                                                <h3 class="text-h3">Add </h3>
                                                                <v-btn icon @click="setViewFindingDialog(false)"
                                                                    size="small" flat>
                                                                    <XIcon size="16" />
                                                                </v-btn>
                                                            </div>
                                                        </v-card-text>
                                                        <v-divider></v-divider>

                                                        <v-card-text>

                                                            <VForm v-model="valid" ref="formContainer" fast-fail
                                                                lazy-validation @submit.prevent="sendFindings"
                                                                class="py-1">
                                                                <VRow class="mt-5 mb-3">

                                                                    <VCol cols="12" md="12">
                                                                        <v-label
                                                                            class="text-subtitle-1 font-weight-medium pb-1">Details</v-label>
                                                                        <VTextarea variant="outlined" outlined
                                                                            name="Description" label="Details"
                                                                            v-model="stepFiveFields.detail"
                                                                            :rules="stepFiveFieldRules.detail" required
                                                                            :color="stepFiveFields.detail.length > 10 ? 'success' : 'primary'">
                                                                        </VTextarea>
                                                                    </VCol>
                                                                    
                                                                    <VCol cols="12" md="12">
                                                                        <v-label
                                                                            class="font-weight-medium pb-1">File</v-label>

                                                                        <v-file-input :show-size="1000"
                                                                            color="deep-purple-accent-4"
                                                                            label="File input"
                                                                            placeholder="Select your files"
                                                                            prepend-icon="mdi-paperclip"
                                                                            variant="outlined" counter
                                                                            accept="image/*, .pdf"
                                                                            @change="selectImage">
                                                                            <template v-slot:selection="{ fileNames }">
                                                                                <template
                                                                                    v-for="(fileName, index) in fileNames"
                                                                                    :key="fileName">
                                                                                    <v-chip v-if="index < 2"
                                                                                        class="me-2"
                                                                                        color="deep-purple-accent-4"
                                                                                        size="small" label>
                                                                                        {{ fileName }}
                                                                                    </v-chip>

                                                                                    <span v-else-if="index === 2"
                                                                                        class="text-overline text-grey-darken-3 mx-2">
                                                                                        +{{ files.length - 2 }} File(s)
                                                                                    </span>
                                                                                </template>
                                                                            </template>
                                                                        </v-file-input>

                                                                    </VCol>
                                                                    <VCol cols="12" lg="12" class="text-right">
                                                                        <v-btn color="error"
                                                                            @click="setViewFindingDialog(false)"
                                                                            variant="text">Cancel</v-btn>

                                                                        <v-btn color="primary" type="submit"
                                                                            :loading="loading" :disabled="!valid"
                                                                            @click="sendFindings">
                                                                            <span v-if="!loading">
                                                                                Submit
                                                                            </span>
                                                                            <clip-loader v-else :loading="loading"
                                                                                color="white"
                                                                                :size="'25px'"></clip-loader>
                                                                        </v-btn>

                                                                    </VCol>
                                                                </VRow>
                                                            </VForm>
                                                        </v-card-text>
                                                    </v-card>
                                                </v-dialog>
                                            </v-sheet>
                                        </v-col>

                                        <v-col cols="12">
                                            <v-table>
                                                <thead>
                                                    <tr>

                                                        <th class="text-left">
                                                            Inspector
                                                        </th>
                                                        <th class="text-left">
                                                            Description
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>{{ getFindings ? `${getFindings?.user?.lastName}
                                                            ${getFindings?.user?.firstName}` : '' }}</td>
                                                        <td>{{ getFindings ? `${getFindings?.description}` : '' }}</td>
                                                    </tr>
                                                </tbody>
                                            </v-table>
                                        </v-col>
                                    </v-row>

                                    <v-row class="mt-3 px-4">


                                        <v-col cols="12">
                                            <v-btn color="primary" @click="setViewRecommendationDialog(true)"
                                                class="mr-2">Add Corrective Action</v-btn>

                                            <v-sheet>
                                                <v-dialog v-model="viewRecommendationDialog" max-width="500">
                                                    <v-card>

                                                        <v-card-text>
                                                            <div class="d-flex justify-space-between">
                                                                <h3 class="text-h3">Add </h3>
                                                                <v-btn icon @click="setViewRecommendationDialog(false)"
                                                                    size="small" flat>
                                                                    <XIcon size="16" />
                                                                </v-btn>
                                                            </div>
                                                        </v-card-text>
                                                        <v-divider></v-divider>

                                                        <v-card-text>

                                                            <VForm v-model="valid" ref="formContainer" fast-fail
                                                                lazy-validation @submit.prevent="sendRecommendation"
                                                                class="py-1">
                                                                <VRow class="mt-5 mb-3">

                                                                    <VCol cols="12" md="12">
                                                                        <v-label
                                                                            class="text-subtitle-1 font-weight-medium pb-1">Title</v-label>
                                                                        <VTextField type="text"
                                                                            v-model="stepFiveFields.title"
                                                                            :rules="stepFiveFieldRules.title" required
                                                                            variant="outlined" label="Title"
                                                                            :color="stepFiveFields.title.length > 2 ? 'success' : 'primary'">
                                                                        </VTextField>
                                                                    </VCol>
                                                                    <VCol cols="12" md="12">
                                                                        <v-label
                                                                            class="text-subtitle-1 font-weight-medium pb-1">Description</v-label>
                                                                        <VTextarea variant="outlined" outlined
                                                                            name="Description" label="Description"
                                                                            v-model="stepFiveFields.description"
                                                                            :rules="stepFiveFieldRules.description"
                                                                            required
                                                                            :color="stepFiveFields.description.length > 10 ? 'success' : 'primary'">
                                                                        </VTextarea>
                                                                    </VCol>
                                                                    <VCol cols="12" md="12">
                                                                        <v-label
                                                                            class="font-weight-medium pb-1">User</v-label>


                                                                        <VSelect v-model="stepFiveFields.assigneeId"
                                                                            :items="isLoggedInUserIsleadInspector ? getInspectingMembers : getInspecteeMembers"
                                                                            :rules="stepFiveFieldRules.assigneeId"
                                                                            label="Select" :selected="''"
                                                                            item-title='lastName' item-value="uuid"
                                                                            single-line variant="outlined"
                                                                            class="text-capitalize"
                                                                            :item-props="(item: any) => ({title:`${item?.lastName} ${item?.firstName}`, subtitle:`${item?.email}`})">

                                                                        </VSelect>
                                                                    </VCol>
                                                                    <VCol cols="12" md="12">
                                                                        <v-label
                                                                            class="font-weight-medium pb-1">Severity</v-label>
                                                                        <VSelect v-model="stepFiveFields.priorityId"
                                                                            :items="getPriorities"
                                                                            :rules="stepFiveFieldRules.priorityId"
                                                                            label="Select" :selected="''"
                                                                            item-title="description" item-value="id"
                                                                            single-line variant="outlined"
                                                                            class="text-capitalize">
                                                                        </VSelect>
                                                                    </VCol>

                                                                    <VCol cols="12" md="6">
                                                                        <v-label
                                                                            class="text-subtitle-1 font-weight-medium pb-1">Start
                                                                            Date</v-label>
                                                                        <VueDatePicker
                                                                            input-class-name="dp-custom-input"
                                                                            v-model="stepFiveFields.start_date"
                                                                            :min-date="new Date()" required>
                                                                        </VueDatePicker>
                                                                    </VCol>
                                                                    <VCol cols="12" md="6">
                                                                        <v-label
                                                                            class="text-subtitle-1 font-weight-medium pb-1">End
                                                                            Date</v-label>
                                                                        <VueDatePicker
                                                                            input-class-name="dp-custom-input"
                                                                            :disabled='!stepFiveFields.start_date'
                                                                            v-model="stepFiveFields.end_date"
                                                                            :min-date="stepFiveFields.start_date ? new Date(stepFiveFields.start_date) : new Date()"
                                                                            required></VueDatePicker>
                                                                    </VCol>

                                                                    <VCol cols="12" lg="12" class="text-right">
                                                                        <v-btn color="error" @click="setViewRecommendationDialog(false)"
                                                                            variant="text">Cancel</v-btn>

                                                                        <v-btn color="primary" type="submit"
                                                                            :loading="loading" :disabled="!valid"
                                                                            @click="sendRecommendation">
                                                                            <span v-if="!loading">
                                                                                Submit
                                                                            </span>
                                                                            <clip-loader v-else :loading="loading"
                                                                                color="white"
                                                                                :size="'25px'"></clip-loader>
                                                                        </v-btn>

                                                                    </VCol>
                                                                </VRow>
                                                            </VForm>
                                                        </v-card-text>
                                                    </v-card>
                                                </v-dialog>

                                            </v-sheet>
                                        </v-col>

                                        <v-col cols="12">
                                            <v-table>
                                                <thead>
                                                    <tr>

                                                        <th class="text-left">
                                                            #
                                                        </th>
                                                        <th class="text-left">
                                                            Title
                                                        </th>
                                                        <th class="text-left">
                                                            Description
                                                        </th>
                                                        <th class="text-left">
                                                            Assignee
                                                        </th>
                                                        <th class="text-left">
                                                            Status
                                                        </th>
                                                        <th class="text-left">
                                                            Priority
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr v-for="(actions, index) in getActions" :key="actions">
                                                        <td>{{ computedIndex(index) }}</td>
                                                        <td>{{ `${actions?.title}` }}</td>
                                                        <td>{{ `${actions?.description}` }}</td>
                                                        <td>{{ `${actions?.assignee?.lastName}
                                                            ${actions?.assignee?.firstName}` }}</td>
                                                        <td>{{ `${actions?.status}` }}</td>
                                                        <td>{{ `${actions?.priority?.description}` }}</td>
                                                    </tr>
                                                </tbody>
                                            </v-table>
                                        </v-col>
                                    </v-row>

                                </div>
                                <v-row class="mt-3">
                                    <v-col cols="6">
                                        <v-btn color="primary" variant="tonal" @click="changeTab('tab-4')">Back</v-btn>
                                    </v-col>
                                    <v-col cols="12" sm="6" class="text-sm-right">
                                        <v-btn color="primary" @click="completeInspection"
                                            v-if="isLoggedInUserIsleadInspector && getOngoingInspection.is_ongoing">Close Inspection</v-btn>

                                    </v-col>

                                </v-row>

                            </v-window-item>
                        </v-window>
                    </v-card-text>
                </UiParentCard>

            </v-col>

        </v-row>
    </div>
</template>
<style lang="scss">
.customTab {
    min-height: 68px;
}
</style>

